---
title: "Họ Việt"
author: "Duc Du"
date: '`r format(Sys.time(), "%d %B, %Y")`'
output: html_document
---

```{r setup, include=FALSE, message=FALSE, warning=FALSE}
rm(list = ls(all.names = TRUE))
library(rmarkdown)
library(knitr)
library(markdown)

knitr::opts_chunk$set(echo = FALSE, 
                      cache=TRUE,
                      autodep = TRUE,
                      tidy.opts=list(width.cutoff=60),
                      tidy=TRUE,
                      fig.width = 33,
                      fig.height = 49)

library(tidyverse)
library(dplyr)
library(ggplot2)
library(data.table)
library(lubridate)
library(viridis)
library(sf)
library(ggpubr)
library(flextable)
library(scales)
library(ggtext)
library(glue)

options(scipen=999, digits = 3)
options(max.print=1000000)
```

```{r load data, message=FALSE, warning=FALSE}
load("data/hoviet.RData")
```

# Tổng họ Việt Nam

```{r, results='hide', message=FALSE, warning=FALSE}
data_ho_overall <- data_ho_overall %>%
  mutate(pro.pop=(songuoi/sum(songuoi))*100)

data_ho_top1000 <- data_ho_overall %>%
  arrange(desc(songuoi))
data_ho_top1000 <- head(data_ho_top1000, n=1000)

data_ho_top500 <- data_ho_overall %>%
  arrange(desc(songuoi))
data_ho_top500 <- head(data_ho_top500, n=500)

data_ho_top200 <- data_ho_overall %>%
  arrange(desc(pro.pop))
data_ho_top200 <- head(data_ho_top200, n=200)

data_ho_top150 <- data_ho_overall %>%
  arrange(desc(songuoi))
data_ho_top150 <- data_ho_top150 %>% slice(101:150)

data_ho_top100 <- data_ho_overall %>%
  arrange(desc(songuoi))
data_ho_top100 <- data_ho_top100 %>% slice(51:100)

data_ho_top50 <- data_ho_overall %>%
  arrange(desc(pro.pop))
data_ho_top50 <- head(data_ho_top50, n=50)

data_ho_top20 <- data_ho_overall %>%
  arrange(desc(songuoi))
data_ho_top20 <- head(data_ho_top20, n=20)

data_ho_top10 <- data_ho_overall %>%
  arrange(desc(songuoi))
data_ho_top10 <- head(data_ho_top10, n=10)
```

## Top 50 họ cao nhất cả nước

```{r}
ggplot(data = data_ho_top50, aes(x = reorder(Ho, songuoi, decreasing=F), y =pro.pop)) +
  geom_bar(stat = "identity", fill="red", width = 0.75) +
  geom_text(aes(label = paste(round(pro.pop, 1), "%", sep = ""), y = pro.pop + 1), size = 10) +
  scale_x_discrete(name = NULL) +
  scale_y_continuous(name = NULL, breaks = seq(from = 0, to = 40, by = 10)) +
  theme_bw() +
  theme(axis.text.x = element_text(size = 30),
        axis.text.y = element_text(size = 30),
        plot.title = element_text(size = 45),
        panel.grid.major = element_blank()) + coord_flip() +
  ggtitle("Top 50 họ có tỉ lệ cao nhất")
```

## Phân bố mật độ tỉ lệ từng họ

```{r}
nguyen_sf <- dat_sf %>% mutate(prop.nguyen=(sum(subset(., Ho=="Nguyễn")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Nguyễn")
tran_sf <- dat_sf %>% mutate(prop.tran=(sum(subset(., Ho=="Trần")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Trần")
le_sf <- dat_sf %>% mutate(prop.le=(sum(subset(., Ho=="Lê")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Lê")
pham_sf <- dat_sf %>% mutate(prop.pham=(sum(subset(., Ho=="Phạm")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Phạm")
hoang_sf <- dat_sf %>% mutate(prop.hoang=(sum(subset(., Ho=="Hoàng")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Hoàng")
bui_sf <- dat_sf %>% mutate(prop.bui=(sum(subset(., Ho=="Bùi")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Bùi")
vu_sf <- dat_sf %>% mutate(prop.vu=(sum(subset(., Ho=="Vũ")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Vũ")
vo_sf <- dat_sf %>% mutate(prop.vo=(sum(subset(., Ho=="Võ")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Võ")
phan_sf <- dat_sf %>% mutate(prop.phan=(sum(subset(., Ho=="Phan")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Phan")
do_sf <- dat_sf %>% mutate(prop.do=(sum(subset(., Ho=="Đỗ")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đỗ")
huynh_sf <- dat_sf %>% mutate(prop.huynh=(sum(subset(., Ho=="Huỳnh")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Huỳnh")
dang_sf <- dat_sf %>% mutate(prop.dang=(sum(subset(., Ho=="Đặng")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đặng")
ngo_sf <- dat_sf %>% mutate(prop.ngo=(sum(subset(., Ho=="Ngô")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Ngô")
truong_sf <- dat_sf %>% mutate(prop.truong=(sum(subset(., Ho=="Trương")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Trương")
dinh_sf <- dat_sf %>% mutate(prop.dinh=(sum(subset(., Ho=="Đinh")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đinh")
ho_sf <- dat_sf %>% mutate(prop.ho=(sum(subset(., Ho=="Hồ")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Hồ")
duong_sf <- dat_sf %>% mutate(prop.duong=(sum(subset(., Ho=="Dương")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Dương")
ha_sf <- dat_sf %>% mutate(prop.ha=(sum(subset(., Ho=="Hà")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Hà")
dao_sf <- dat_sf %>% mutate(prop.dao=(sum(subset(., Ho=="Đào")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đào")
ly_sf <- dat_sf %>% mutate(prop.ly=(sum(subset(., Ho=="Lý")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Lý")
doan_sf <- dat_sf %>% mutate(prop.doan=(sum(subset(., Ho=="Đoàn")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đoàn")
trinh_sf <- dat_sf %>% mutate(prop.trinh=(sum(subset(., Ho=="Trịnh")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Trịnh")
mai_sf <- dat_sf %>% mutate(prop.mai=(sum(subset(., Ho=="Mai")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Mai")
luong_sf <- dat_sf %>% mutate(prop.luong=(sum(subset(., Ho=="Lương")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Lương")
cao_sf <- dat_sf %>% mutate(prop.cao=(sum(subset(., Ho=="Cao")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Cao")
lo_sf <- dat_sf %>% mutate(prop.lo=(sum(subset(., Ho=="Lò")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Lò")
lam_sf <- dat_sf %>% mutate(prop.lam=(sum(subset(., Ho=="Lâm")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Lâm")
luu_sf <- dat_sf %>% mutate(prop.luu=(sum(subset(., Ho=="Lưu")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Lưu")
phung_sf <- dat_sf %>% mutate(prop.phung=(sum(subset(., Ho=="Phùng")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Phùng")
ta_sf <- dat_sf %>% mutate(prop.ta=(sum(subset(., Ho=="Tạ")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Tạ")
thach_sf <- dat_sf %>% mutate(prop.thach=(sum(subset(., Ho=="Thạch")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Thạch")
trieu_sf <- dat_sf %>% mutate(prop.trieu=(sum(subset(., Ho=="Triệu")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Triệu")
y_sf <- dat_sf %>% mutate(prop.y=(sum(subset(., Ho=="Y")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Y")
vi_sf <- dat_sf %>% mutate(prop.vi=(sum(subset(., Ho=="Vi")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Vi")
chu_sf <- dat_sf %>% mutate(prop.chu=(sum(subset(., Ho=="Chu")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Chu")
nong_sf <- dat_sf %>% mutate(prop.nong=(sum(subset(., Ho=="Nông")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Nông")
to_sf <- dat_sf %>% mutate(prop.to=(sum(subset(., Ho=="Tô")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Tô")
thai_sf <- dat_sf %>% mutate(prop.thai=(sum(subset(., Ho=="Thái")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Thái")
chau_sf <- dat_sf %>% mutate(prop.chau=(sum(subset(., Ho=="Châu")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Châu")
giang_sf <- dat_sf %>% mutate(prop.giang=(sum(subset(., Ho=="Giàng")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Giàng")
vuong_sf <- dat_sf %>% mutate(prop.vuong=(sum(subset(., Ho=="Vương")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Vương")
h_sf <- dat_sf %>% mutate(prop.h=(sum(subset(., Ho=="H")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="H")
quach_sf <- dat_sf %>% mutate(prop.quach=(sum(subset(., Ho=="Quách")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Quách")
vang_sf <- dat_sf %>% mutate(prop.vang=(sum(subset(., Ho=="Vàng")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Vàng")
danh_sf <- dat_sf %>% mutate(prop.danh=(sum(subset(., Ho=="Danh")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Danh")
luong2_sf <- dat_sf %>% mutate(prop.luong2=(sum(subset(., Ho=="Lường")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Lường")
dam_sf <- dat_sf %>% mutate(prop.dam=(sum(subset(., Ho=="Đàm")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đàm")
sung_sf <- dat_sf %>% mutate(prop.sung=(sum(subset(., Ho=="Sùng")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Sùng")
thi_sf <- dat_sf %>% mutate(prop.thi=(sum(subset(., Ho=="Thị")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Thị")
a_sf <- dat_sf %>% mutate(prop.a=(sum(subset(., Ho=="A")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="A")
```

```{r}
nguyen_his <- nguyen_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(nguyen_sf$pro.pop), sd = sd(nguyen_sf$pro.pop))) +
  ggtitle("Nguyễn")

tran_his <- tran_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(tran_sf$pro.pop), sd = sd(tran_sf$pro.pop))) +
  ggtitle("Trần")

le_his <- le_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(le_sf$pro.pop), sd = sd(le_sf$pro.pop))) +
  ggtitle("Lê")

pham_his <- pham_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(pham_sf$pro.pop), sd = sd(pham_sf$pro.pop))) +
  ggtitle("Phạm")

hoang_his <- hoang_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(hoang_sf$pro.pop), sd = sd(hoang_sf$pro.pop))) +
  ggtitle("Hoàng")

bui_his <- bui_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(bui_sf$pro.pop), sd = sd(bui_sf$pro.pop))) +
  ggtitle("Bùi")

vu_his <- vu_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(vu_sf$pro.pop), sd = sd(vu_sf$pro.pop))) +
  ggtitle("Vũ")

vo_his <- vo_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(vo_sf$pro.pop), sd = sd(vo_sf$pro.pop))) +
  ggtitle("Võ")

phan_his <- phan_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(phan_sf$pro.pop), sd = sd(phan_sf$pro.pop))) +
  ggtitle("Phan")

do_his <- do_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(do_sf$pro.pop), sd = sd(do_sf$pro.pop))) +
  ggtitle("Đỗ")

huynh_his <- huynh_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(huynh_sf$pro.pop), sd = sd(huynh_sf$pro.pop))) +
  ggtitle("Huỳnh")

dang_his <- dang_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(dang_sf$pro.pop), sd = sd(dang_sf$pro.pop))) +
  ggtitle("Đặng")

ngo_his <- ngo_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(ngo_sf$pro.pop), sd = sd(ngo_sf$pro.pop))) +
  ggtitle("Ngô")

truong_his <- truong_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(truong_sf$pro.pop), sd = sd(truong_sf$pro.pop))) +
  ggtitle("Trương")

dinh_his <- dinh_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(dinh_sf$pro.pop), sd = sd(dinh_sf$pro.pop))) +
  ggtitle("Đinh")

duong_his <- duong_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(duong_sf$pro.pop), sd = sd(duong_sf$pro.pop))) +
  ggtitle("Dương")

ho_his <- ho_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(ho_sf$pro.pop), sd = sd(ho_sf$pro.pop))) +
  ggtitle("Hồ")

ha_his <- ha_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(ha_sf$pro.pop), sd = sd(ha_sf$pro.pop))) +
  ggtitle("Hà")

dao_his <- dao_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(dao_sf$pro.pop), sd = sd(dao_sf$pro.pop))) +
  ggtitle("Đào")

doan_his <- doan_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(doan_sf$pro.pop), sd = sd(doan_sf$pro.pop))) +
  ggtitle("Đoàn")

ly_his <- ly_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(ly_sf$pro.pop), sd = sd(ly_sf$pro.pop))) +
  ggtitle("Lý")

trinh_his <- trinh_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(trinh_sf$pro.pop), sd = sd(trinh_sf$pro.pop))) +
  ggtitle("Trịnh")

mai_his <- mai_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(mai_sf$pro.pop), sd = sd(mai_sf$pro.pop))) +
  ggtitle("Mai")

luong_his <- luong_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(luong_sf$pro.pop), sd = sd(luong_sf$pro.pop))) +
  ggtitle("Lương")

cao_his <- cao_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(cao_sf$pro.pop), sd = sd(cao_sf$pro.pop))) +
  ggtitle("Cao")

lam_his <- lam_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(lam_sf$pro.pop), sd = sd(lam_sf$pro.pop))) +
  ggtitle("Lâm")

lo_his <- lo_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(lo_sf$pro.pop), sd = sd(lo_sf$pro.pop))) +
  ggtitle("Lò")

luu_his <- luu_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(luu_sf$pro.pop), sd = sd(luu_sf$pro.pop))) +
  ggtitle("Lưu")

phung_his <- phung_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(phung_sf$pro.pop), sd = sd(phung_sf$pro.pop))) +
  ggtitle("Phùng")

ta_his <- ta_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(ta_sf$pro.pop), sd = sd(ta_sf$pro.pop))) +
  ggtitle("Tạ")

thach_his <- thach_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(thach_sf$pro.pop), sd = sd(thach_sf$pro.pop))) +
  ggtitle("Thạch")

trieu_his <- trieu_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(trieu_sf$pro.pop), sd = sd(trieu_sf$pro.pop))) +
  ggtitle("Triệu")

y_his <- y_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(y_sf$pro.pop), sd = sd(y_sf$pro.pop))) +
  ggtitle("Y")

vi_his <- vi_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(vi_sf$pro.pop), sd = sd(vi_sf$pro.pop))) +
  ggtitle("Vi")

chu_his <- chu_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(chu_sf$pro.pop), sd = sd(chu_sf$pro.pop))) +
  ggtitle("Chu")

nong_his <- nong_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(nong_sf$pro.pop), sd = sd(nong_sf$pro.pop))) +
  ggtitle("Nông")

to_his <- to_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(to_sf$pro.pop), sd = sd(to_sf$pro.pop))) +
  ggtitle("Tô")

thai_his <- thai_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(thai_sf$pro.pop), sd = sd(thai_sf$pro.pop))) +
  ggtitle("Thái")

chau_his <- chau_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(chau_sf$pro.pop), sd = sd(chau_sf$pro.pop))) +
  ggtitle("Châu")

giang_his <- giang_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(giang_sf$pro.pop), sd = sd(giang_sf$pro.pop))) +
  ggtitle("Giàng")

vuong_his <- vuong_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(vuong_sf$pro.pop), sd = sd(vuong_sf$pro.pop))) +
  ggtitle("Vương")

h_his <- h_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(h_sf$pro.pop), sd = sd(h_sf$pro.pop))) +
  ggtitle("H")

quach_his <- quach_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(quach_sf$pro.pop), sd = sd(quach_sf$pro.pop))) +
  ggtitle("Quách")

vang_his <- vang_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(vang_sf$pro.pop), sd = sd(vang_sf$pro.pop))) +
  ggtitle("Vàng")

danh_his <- danh_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(danh_sf$pro.pop), sd = sd(danh_sf$pro.pop))) +
  ggtitle("Danh")

luong2_his <- luong2_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(luong2_sf$pro.pop), sd = sd(luong2_sf$pro.pop))) +
  ggtitle("Lường")

dam_his <- dam_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(dam_sf$pro.pop), sd = sd(dam_sf$pro.pop))) +
  ggtitle("Đàm")

sung_his <- sung_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(sung_sf$pro.pop), sd = sd(sung_sf$pro.pop))) +
  ggtitle("Sùng")

thi_his <- thi_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(thi_sf$pro.pop), sd = sd(thi_sf$pro.pop))) +
  ggtitle("Thị")

a_his <- a_sf %>% 
  ggplot(aes(x=pro.pop)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(a_sf$pro.pop), sd = sd(a_sf$pro.pop))) +
  ggtitle("A")
```

```{r, message=FALSE, warning=FALSE}
ggarrange(nguyen_his, tran_his, le_his, pham_his, hoang_his,
          bui_his, vu_his, vo_his, phan_his, do_his,
          huynh_his, dang_his, ngo_his, truong_his, dinh_his,
          ho_his, duong_his, ha_his, dao_his, ly_his,
          doan_his, trinh_his, mai_his, luong_his, cao_his,
          lo_his, lam_his, luu_his, phung_his, ta_his,
          thach_his, y_his, trieu_his, vi_his, chu_his,
          nong_his, to_his, thai_his, chau_his, giang_his,
          vuong_his, h_his, quach_his, vang_his, danh_his,
          luong2_his, dam_his, sung_his, thi_his, a_his,
          ncol = 5, nrow = 10)
```

## Phân bố mật độ từng họ

```{r}
nguyen_sff <- dat_sff %>% mutate(prop.nguyen=(sum(subset(., Ho=="Nguyễn")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Nguyễn")
tran_sff <- dat_sff %>% mutate(prop.tran=(sum(subset(., Ho=="Trần")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Trần")
le_sff <- dat_sff %>% mutate(prop.le=(sum(subset(., Ho=="Lê")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Lê")
pham_sff <- dat_sff %>% mutate(prop.pham=(sum(subset(., Ho=="Phạm")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Phạm")
hoang_sff <- dat_sff %>% mutate(prop.hoang=(sum(subset(., Ho=="Hoàng")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Hoàng")
bui_sff <- dat_sff %>% mutate(prop.bui=(sum(subset(., Ho=="Bùi")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Bùi")
vu_sff <- dat_sff %>% mutate(prop.vu=(sum(subset(., Ho=="Vũ")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Vũ")
vo_sff <- dat_sff %>% mutate(prop.vo=(sum(subset(., Ho=="Võ")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Võ")
phan_sff <- dat_sff %>% mutate(prop.phan=(sum(subset(., Ho=="Phan")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Phan")
do_sff <- dat_sff %>% mutate(prop.do=(sum(subset(., Ho=="Đỗ")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đỗ")
huynh_sff <- dat_sff %>% mutate(prop.huynh=(sum(subset(., Ho=="Huỳnh")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Huỳnh")
dang_sff <- dat_sff %>% mutate(prop.dang=(sum(subset(., Ho=="Đặng")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đặng")
ngo_sff <- dat_sff %>% mutate(prop.ngo=(sum(subset(., Ho=="Ngô")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Ngô")
truong_sff <- dat_sff %>% mutate(prop.truong=(sum(subset(., Ho=="Trương")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Trương")
dinh_sff <- dat_sff %>% mutate(prop.dinh=(sum(subset(., Ho=="Đinh")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đinh")
ho_sff <- dat_sff %>% mutate(prop.ho=(sum(subset(., Ho=="Hồ")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Hồ")
duong_sff <- dat_sff %>% mutate(prop.duong=(sum(subset(., Ho=="Dương")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Dương")
ha_sff <- dat_sff %>% mutate(prop.ha=(sum(subset(., Ho=="Hà")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Hà")
dao_sff <- dat_sff %>% mutate(prop.dao=(sum(subset(., Ho=="Đào")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đào")
ly_sff <- dat_sff %>% mutate(prop.ly=(sum(subset(., Ho=="Lý")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Lý")
doan_sff <- dat_sff %>% mutate(prop.doan=(sum(subset(., Ho=="Đoàn")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đoàn")
trinh_sff <- dat_sff %>% mutate(prop.trinh=(sum(subset(., Ho=="Trịnh")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Trịnh")
mai_sff <- dat_sff %>% mutate(prop.mai=(sum(subset(., Ho=="Mai")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Mai")
luong_sff <- dat_sff %>% mutate(prop.luong=(sum(subset(., Ho=="Lương")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Lương")
cao_sff <- dat_sff %>% mutate(prop.cao=(sum(subset(., Ho=="Cao")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Cao")
lo_sff <- dat_sff %>% mutate(prop.lo=(sum(subset(., Ho=="Lò")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Lò")
lam_sff <- dat_sff %>% mutate(prop.lam=(sum(subset(., Ho=="Lâm")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Lâm")
luu_sff <- dat_sff %>% mutate(prop.luu=(sum(subset(., Ho=="Lưu")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Lưu")
phung_sff <- dat_sff %>% mutate(prop.phung=(sum(subset(., Ho=="Phùng")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Phùng")
ta_sff <- dat_sff %>% mutate(prop.ta=(sum(subset(., Ho=="Tạ")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Tạ")
thach_sff <- dat_sff %>% mutate(prop.thach=(sum(subset(., Ho=="Thạch")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Thạch")
trieu_sff <- dat_sff %>% mutate(prop.trieu=(sum(subset(., Ho=="Triệu")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Triệu")
y_sff <- dat_sff %>% mutate(prop.y=(sum(subset(., Ho=="Y")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Y")
vi_sff <- dat_sff %>% mutate(prop.vi=(sum(subset(., Ho=="Vi")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Vi")
chu_sff <- dat_sff %>% mutate(prop.chu=(sum(subset(., Ho=="Chu")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Chu")
nong_sff <- dat_sff %>% mutate(prop.nong=(sum(subset(., Ho=="Nông")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Nông")
to_sff <- dat_sff %>% mutate(prop.to=(sum(subset(., Ho=="Tô")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Tô")
thai_sff <- dat_sff %>% mutate(prop.thai=(sum(subset(., Ho=="Thái")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Thái")
chau_sff <- dat_sff %>% mutate(prop.chau=(sum(subset(., Ho=="Châu")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Châu")
giang_sff <- dat_sff %>% mutate(prop.giang=(sum(subset(., Ho=="Giàng")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Giàng")
vuong_sff <- dat_sff %>% mutate(prop.vuong=(sum(subset(., Ho=="Vương")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Vương")
h_sff <- dat_sff %>% mutate(prop.h=(sum(subset(., Ho=="H")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="H")
quach_sff <- dat_sff %>% mutate(prop.quach=(sum(subset(., Ho=="Quách")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Quách")
vang_sff <- dat_sff %>% mutate(prop.vang=(sum(subset(., Ho=="Vàng")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Vàng")
danh_sff <- dat_sff %>% mutate(prop.danh=(sum(subset(., Ho=="Danh")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Danh")
luong2_sff <- dat_sff %>% mutate(prop.luong2=(sum(subset(., Ho=="Lường")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Lường")
dam_sff <- dat_sff %>% mutate(prop.dam=(sum(subset(., Ho=="Đàm")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đàm")
sung_sff <- dat_sff %>% mutate(prop.sung=(sum(subset(., Ho=="Sùng")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Sùng")
thi_sff <- dat_sff %>% mutate(prop.thi=(sum(subset(., Ho=="Thị")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Thị")
a_sff <- dat_sff %>% mutate(prop.a=(sum(subset(., Ho=="A")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="A")
```

```{r}
nguyen_hisf <- nguyen_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(nguyen_sff$songuoi_km), sd = sd(nguyen_sff$songuoi_km))) +
  ggtitle("Nguyễn")

tran_hisf <- tran_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(tran_sff$songuoi_km), sd = sd(tran_sff$songuoi_km))) +
  ggtitle("Trần")

le_hisf <- le_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(le_sff$songuoi_km), sd = sd(le_sff$songuoi_km))) +
  ggtitle("Lê")

pham_hisf <- pham_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(pham_sff$songuoi_km), sd = sd(pham_sff$songuoi_km))) +
  ggtitle("Phạm")

hoang_hisf <- hoang_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(hoang_sff$songuoi_km), sd = sd(hoang_sff$songuoi_km))) +
  ggtitle("Hoàng")

bui_hisf <- bui_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(bui_sff$songuoi_km), sd = sd(bui_sff$songuoi_km))) +
  ggtitle("Bùi")

vu_hisf <- vu_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(vu_sff$songuoi_km), sd = sd(vu_sff$songuoi_km))) +
  ggtitle("Vũ")

vo_hisf <- vo_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(vo_sff$songuoi_km), sd = sd(vo_sff$songuoi_km))) +
  ggtitle("Võ")

phan_hisf <- phan_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(phan_sff$songuoi_km), sd = sd(phan_sff$songuoi_km))) +
  ggtitle("Phan")

do_hisf <- do_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(do_sff$songuoi_km), sd = sd(do_sff$songuoi_km))) +
  ggtitle("Đỗ")

huynh_hisf <- huynh_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(huynh_sff$songuoi_km), sd = sd(huynh_sff$songuoi_km))) +
  ggtitle("Huỳnh")

dang_hisf <- dang_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(dang_sff$songuoi_km), sd = sd(dang_sff$songuoi_km))) +
  ggtitle("Đặng")

ngo_hisf <- ngo_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(ngo_sff$songuoi_km), sd = sd(ngo_sff$songuoi_km))) +
  ggtitle("Ngô")

truong_hisf <- truong_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(truong_sff$songuoi_km), sd = sd(truong_sff$songuoi_km))) +
  ggtitle("Trương")

dinh_hisf <- dinh_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(dinh_sff$songuoi_km), sd = sd(dinh_sff$songuoi_km))) +
  ggtitle("Đinh")

duong_hisf <- duong_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(duong_sff$songuoi_km), sd = sd(duong_sff$songuoi_km))) +
  ggtitle("Dương")

ho_hisf <- ho_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(ho_sff$songuoi_km), sd = sd(ho_sff$songuoi_km))) +
  ggtitle("Hồ")

ha_hisf <- ha_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(ha_sff$songuoi_km), sd = sd(ha_sff$songuoi_km))) +
  ggtitle("Hà")

dao_hisf <- dao_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(dao_sff$songuoi_km), sd = sd(dao_sff$songuoi_km))) +
  ggtitle("Đào")

doan_hisf <- doan_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(doan_sff$songuoi_km), sd = sd(doan_sff$songuoi_km))) +
  ggtitle("Đoàn")

ly_hisf <- ly_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(ly_sff$songuoi_km), sd = sd(ly_sff$songuoi_km))) +
  ggtitle("Lý")

trinh_hisf <- trinh_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(trinh_sff$songuoi_km), sd = sd(trinh_sff$songuoi_km))) +
  ggtitle("Trịnh")

mai_hisf <- mai_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(mai_sff$songuoi_km), sd = sd(mai_sff$songuoi_km))) +
  ggtitle("Mai")

luong_hisf <- luong_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(luong_sff$songuoi_km), sd = sd(luong_sff$songuoi_km))) +
  ggtitle("Lương")

cao_hisf <- cao_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(cao_sff$songuoi_km), sd = sd(cao_sff$songuoi_km))) +
  ggtitle("Cao")

lam_hisf <- lam_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(lam_sff$songuoi_km), sd = sd(lam_sff$songuoi_km))) +
  ggtitle("Lâm")

lo_hisf <- lo_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(lo_sff$songuoi_km), sd = sd(lo_sff$songuoi_km))) +
  ggtitle("Lò")

luu_hisf <- luu_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(luu_sff$songuoi_km), sd = sd(luu_sff$songuoi_km))) +
  ggtitle("Lưu")

phung_hisf <- phung_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(phung_sff$songuoi_km), sd = sd(phung_sff$songuoi_km))) +
  ggtitle("Phùng")

ta_hisf <- ta_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(ta_sff$songuoi_km), sd = sd(ta_sff$songuoi_km))) +
  ggtitle("Tạ")

thach_hisf <- thach_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(thach_sff$songuoi_km), sd = sd(thach_sff$songuoi_km))) +
  ggtitle("Thạch")

trieu_hisf <- trieu_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(trieu_sff$songuoi_km), sd = sd(trieu_sff$songuoi_km))) +
  ggtitle("Triệu")

y_hisf <- y_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(y_sff$songuoi_km), sd = sd(y_sff$songuoi_km))) +
  ggtitle("Y")

vi_hisf <- vi_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(vi_sff$songuoi_km), sd = sd(vi_sff$songuoi_km))) +
  ggtitle("Vi")

chu_hisf <- chu_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(chu_sff$songuoi_km), sd = sd(chu_sff$songuoi_km))) +
  ggtitle("Chu")

nong_hisf <- nong_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(nong_sff$songuoi_km), sd = sd(nong_sff$songuoi_km))) +
  ggtitle("Nông")

to_hisf <- to_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(to_sff$songuoi_km), sd = sd(to_sff$songuoi_km))) +
  ggtitle("Tô")

thai_hisf <- thai_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(thai_sff$songuoi_km), sd = sd(thai_sff$songuoi_km))) +
  ggtitle("Thái")

chau_hisf <- chau_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(chau_sff$songuoi_km), sd = sd(chau_sff$songuoi_km))) +
  ggtitle("Châu")

giang_hisf <- giang_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(giang_sff$songuoi_km), sd = sd(giang_sff$songuoi_km))) +
  ggtitle("Giàng")

vuong_hisf <- vuong_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(vuong_sff$songuoi_km), sd = sd(vuong_sff$songuoi_km))) +
  ggtitle("Vương")

h_hisf <- h_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(h_sff$songuoi_km), sd = sd(h_sff$songuoi_km))) +
  ggtitle("H")

quach_hisf <- quach_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(quach_sff$songuoi_km), sd = sd(quach_sff$songuoi_km))) +
  ggtitle("Quách")

vang_hisf <- vang_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(vang_sff$songuoi_km), sd = sd(vang_sff$songuoi_km))) +
  ggtitle("Vàng")

danh_hisf <- danh_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(danh_sff$songuoi_km), sd = sd(danh_sff$songuoi_km))) +
  ggtitle("Danh")

luong2_hisf <- luong2_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(luong2_sff$songuoi_km), sd = sd(luong2_sff$songuoi_km))) +
  ggtitle("Lường")

dam_hisf <- dam_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(dam_sff$songuoi_km), sd = sd(dam_sff$songuoi_km))) +
  ggtitle("Đàm")

sung_hisf <- sung_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(sung_sff$songuoi_km), sd = sd(sung_sff$songuoi_km))) +
  ggtitle("Sùng")

thi_hisf <- thi_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(thi_sff$songuoi_km), sd = sd(thi_sff$songuoi_km))) +
  ggtitle("Thị")

a_hisf <- a_sff %>% 
  ggplot(aes(x=songuoi_km)) +
  geom_histogram(aes(y =..density..), color="#e9ecef", alpha=0.6, position = 'identity') +
  theme_bw() + 
  stat_function(fun = dnorm, args = list(mean = mean(a_sff$songuoi_km), sd = sd(a_sff$songuoi_km))) +
  ggtitle("A")
```

```{r, message=FALSE, warning=FALSE}
ggarrange(nguyen_hisf, tran_hisf, le_hisf, pham_hisf, hoang_hisf,
          bui_hisf, vu_hisf, vo_hisf, phan_hisf, do_hisf,
          huynh_hisf, dang_hisf, ngo_hisf, truong_hisf, dinh_hisf,
          ho_hisf, duong_hisf, ha_hisf, dao_hisf, ly_hisf,
          doan_hisf, trinh_hisf, mai_hisf, luong_hisf, cao_hisf,
          lo_hisf, lam_hisf, luu_hisf, phung_hisf, ta_hisf,
          thach_hisf, y_hisf, trieu_hisf, vi_hisf, chu_hisf,
          nong_hisf, to_hisf, thai_hisf, chau_hisf, giang_hisf,
          vuong_hisf, h_hisf, quach_hisf, vang_hisf, danh_hisf,
          luong2_hisf, dam_hisf, sung_hisf, thi_hisf, a_hisf,
          ncol = 5, nrow = 10)
```

## Top 200 họ phổ biến nhất Việt Nam theo cả nước và tỉnh

```{r}
data_ho_top200 <- data_ho_overall %>%
  mutate(pro.pop=round(pro.pop, 2)) %>%
  arrange(desc(pro.pop))
data_ho_top200 <- head(data_ho_top200, n=200)

songuoi<-as.matrix(dat_sf$songuoi)
NAME_1 <- dat_sf$NAME_1
Ho <- dat_sf$Ho
data_ho_tinh_sum <- aggregate(songuoi, data.frame(NAME_1, Ho), sum) %>% setDT() %>%
  rename(songuoi=V1)
data_ho_tinh_sum <- data_ho_tinh_sum %>%
  group_by(NAME_1) %>%
  mutate(danso=sum(songuoi)) %>% ungroup() %>%
  mutate(pro.pop=round((songuoi/danso)*100,2)) %>% 
  filter(Ho %in% data_ho_top200$Ho) %>%
  select(NAME_1, Ho, pro.pop)

data_ho_tinh_wide <- data_ho_tinh_sum %>% spread(NAME_1, pro.pop)

data_ho_top200 <- merge(data_ho_top200 %>% select(Ho, pro.pop), data_ho_tinh_wide, by="Ho")
data_ho_top200[is.na(data_ho_top200)] <- 0
data_ho_top200 <- data_ho_top200 %>%
  arrange(desc(pro.pop)) %>%
  rownames_to_column() %>%
  rename("TT"=rowname,
         "Họ"=Ho,
         "Cả nước (%)"=pro.pop)
```

```{r, fig.width=49, fig.height=33}
mycolor <- function(x) {
  output <- ifelse(x == 0, "#FFFFFF",
                   ifelse(x < 1, "#6baed6",
                          ifelse(x < 5, "#fee5d9",
                                 ifelse(x < 10, "#fcae91",
                                        ifelse(x < 30, "#fb6a4a",
                                               ifelse(x < 60, "#cb181d", "#FFFFFF"))))))
  return(output)
}

mytab_cum <- function(label) {
  ft <- flextable(data_ho_top200) %>%
    fontsize(size = 7, part = "all") %>%
    set_caption(caption = label) %>%
    set_table_properties(width=1, layout = "autofit")

h_header <- max( dim_pretty(ft, part = "header")$widths)

ft %>%
  bg(j=c(-1), bg = mycolor) %>%
  valign(valign = "center", part = "header") %>%
  height(height = h_header * 0.8, part = "header") %>%
  hrule(i = 1, rule = "exact", part = "all") %>%
  width(width = 49)
}

mytab_cum(label = NULL)
```


# Phân bố dòng họ cả nước

## Mai

Mai Hắc Đế (梅黑帝; 670 – 723). 

Dã sử kể rằng
Mai An Tiêm vốn là con nuôi của Hùng Vương thứ XVII, được vua quý mến gả mị nương tức là nàng Ba cho. Sau vì làm phật ý vua, An Tiêm bị đày ra đảo hoang, tương truyền nay là vùng Nga Sơn, Thanh Hóa. Tại đây, An Tiêm cùng vợ chăm chỉ làm ăn. Một hôm, An Tiêm nhặt được hạt giống cây lạ do chim mang tới, anh đem gieo trồng và cuối cùng gây được giống dưa hấu quý, nhiều người tìm đến trao đổi, tiếng đồn khắp xa gần. Vua biết tin, xuống chiếu gọi về cho phục chức cũ. An Tiêm được coi là ông tổ của nghề trồng dưa hấu tại Việt Nam.

Đền thờ Mai An Tiêm dưới chân núi Mai An Tiêm ở Nga Sơn
Ngày nay, tại xã Nga Phú, huyện Nga Sơn, có một dãy núi mang tên Mai An Tiêm, tương truyền chính là hòn đảo xưa kia vợ chồng An Tiêm đi đày. Dưới chân núi này có đền thờ ông và được nhân dân địa phương tổ chức lễ hội vào ngày 12 đến 15 tháng Ba âm lịch hàng năm.
Tên thật của Mai Hắc Đế (梅黑帝; 670 – 723) là Mai Thúc Loan (梅叔鸞), người lãnh đạo thành công cuộc khởi nghĩa chống lại sự chiếm đóng của nhà Đường ở Việt Nam và xưng Đế. 

Mai Thúc Loan sinh vào năm Canh Ngọ (670) tại thôn Ngọc Trừng, Hoan Châu, nay thuộc huyện Nam Đàn, Nghệ An. Theo Việt Điện U Linh (do Lý Tế Xuyên soạn năm 1329), cha của Mai Thúc Loan là Mai Hoàn, mẹ là Mai An Hòa nguyên gốc Lộc Hà, Hà Tĩnh, lưu lạc sang vùng Nam Đàn, Nghệ An.

Theo sách Việt Sử Tiêu Án (Ngô Thì Sĩ viết năm 1775), Mai Thúc Loan là người làng Hương Lãm, huyện Nam Đường, nay là thị trấn Nam Đàn, tỉnh Nghệ An, dân lập đền thờ ông ở thôn chợ Sa Nam
Dịch nghĩa phần nói về Mai Hắc Đế trong "Cựu Đường Thư, Liệt truyện 134, Hoạn quan, Quyển 184". 

Những năm đầu niên hiệu Khai Nguyên (713-741), thủ lĩnh An Nam là Mai Huyền Thành làm phản, tự xưng là "Vua Đen" (Hắc Đế), chiêu tập quân 32 châu, ngoài liên kết với các nước Lâm Ấp, Chân Lạp và Kim Lân, giữ vùng biển nam, quân số có đến 40 vạn, đánh phá phủ thành An Nam. Tháng 7, mùa thu năm Khai Nguyên thứ 10, (Hoàng đế) Đường Huyền Tông, ra lời chiếu sai hoạn quan Tả Giám môn Vệ tướng quân là Dương Tư Húc và quan Đô hộ là Quang Sở Khách đem quân dánh dẹp. Tư Húc đến Lĩnh Nam, chiêu mộ con em bọn thủ lĩnh ở đó, người và ngựa được hơn mười vạn, theo đường cũ của Mã Viện mà tiến đánh bất ngờ. Bọn Huyền Thành chợt nghe tin quân (của Tư Húc) đến, hoảng sợ không nghĩ được kế gì, liền bị quan quân bắt hoặc chém chết tại trận, giết hết phe đảng, dồn xác chết thành đống rồi rút quân về.
Cuộc khởi nghĩa nổ ra tại Rú Đụn, còn gọi là Hùng Sơn (Nghệ An). Mai Thúc Loan lên ngôi vua, lấy hiệu là Mai Hắc Đế. Theo Việt điện u linh, Mai Hắc Đế mang mệnh thủy tức là nước, mà nước được tượng trưng là màu đen. Vì vậy, ông lấy hiệu là Hắc Đế để hợp với mệnh của mình. Một số nguồn cũng cho hay, ông lấy hiệu là Mai Hắc Đế vì ông có màu da đen. Ông cho xây thành lũy, lập kinh đô Vạn An (thuộc thị trấn Nam Đàn hiện nay), tích cực rèn tập tướng sỹ. Cuộc nổi dậy của ông được hưởng ứng rộng rãi ở trong nước và có cả sự liên kết với Lâm Ấp và Chân Lạp.

Do phân bố dòng họ có dạng phân bố chuẩn. Xét trên sơ đồ phân bố dòng họ do Đức Dư tổng hợp theo dữ liệu của TCTK, chúng ta có thể khẳng định:
1- Sự kiện về dòng họ vua Mai Hắc Đế là có thật
2- Dòng họ của Mai Hắc Đế phát tích ở vùng Nga Sơn thuộc Thanh Hóa, nơi có đền thờ Mai An Tiêm. Vào thời Mai Hắc Đế vùng này là bờ biển. 

Có vẻ như dã sử về Mai An Tiêm có chứa ở trong nó một phần nào đó sự thật. Không biết sự thật ấy có liên quan tới Mai Hắc Đế không.
Về nguyên nhân cuộc khởi nghĩa do Mai Thúc Loan lãnh đạo là sự phản kháng chống lại sự áp bức của chính quyền đô hộ Phương Bắc, Nhà Hán. Cuộc khởi nghĩa có lẽ đã xảy ra, bắt đầu ở vùng có mỏ khai thác thiếc, thuộc khu vực Nghệ An, Thanh Hóa, Hòa Bình.
Thiếc có thể là mối liên hệ giữa các cuộc khởi nghĩa từ Mai Thúc Loan tới Ngô Quyền. Thậm chí có thể là từ Lý Bí. 

Trước hết chúng ta truy tìm ngược lại đồ cống nạp cho Nhà Đường. 
Trong truyện 西门庆择吉佳期　应伯爵追欢喜庆 có đề cập tới "Bạch Lạp"
”妇人因指道：“奴这床后茶叶箱内，还藏三四十斤沉香、二百斤白蜡、两罐子水银、八十斤胡椒。你明日都搬出来，替我卖了银子，凑著你盖房子使。
Dịch nghĩa 
"Người phụ nữ nói," Trong hộp trà phía sau chiếc giường này, vẫn còn ba 34 lạng trầm hương, 200 lạng 白蜡 (白蠟), hai lọ thủy ngân, và 80 lạng 胡椒 (hạt tiêu). Ngày mai anh bán lấy tiền cho em và cùng anh xây nhà.
Trong truyện 愿同穴一时丧礼盛　守孤灵半夜口脂香
có đoạn đề cập tới 白蜡 là 
”有二青衣官吏跪下，毡包内捧出一对金段、一根沉香、两根白蜡、一分绵纸。黄主事道：“此乃宋公致赙之仪。那两封，是两司八府官员办酒分资──两司官十二员、府官八员，计二十二分，共一百零六两。
dịch nghĩa 
"Có hai viên chức quỳ xuống dâng hai miếng vàng, một miếng trầm hương, hai miếng sáp trắng, và một mẩu giấy để trong túi nỉ. Sư Hoàng nói: "Đây là nghi thức của Tống gia. Hai bức thư đó là để cho hai vị quan và tám quan xử uống rượu, trả công. ... " 
Ngày nay từ Bạch Lạp 白蜡 (白蠟) đều được hiểu là sáp ong. Tuy nhiên với bối cảnh như các đoạn văn trên thì có thể Bạch Lạp 白蜡 là kim loại quý màu trắng. Bạc 银 và Gang Trắng 白铁 được dùng ở  Tây Hán, Tống và Thanh khá lâu trước Công Nguyên, vì thế không thể có sự nhầm lẫn về con chữ. Vậy có lẽ Bạch Lạp 白蜡 là thiếc. 
Tìm trong Thái Bình hoàn vũ kí 太平寰宇記 (quyển 171) dòng 65 trong https://ctext.org/wiki.pl?if=gb&chapter=185380
phần  維基 -> 太平寰宇記 -> 卷一百七十一 
với nội dung
土産
貢白蠟　紫緋　騏麟竭　無名異
dịch 
Thổ sản: cống gồm bạch lạp 貢白蠟 (sáp trắng), tử phi, sừng tê, và nhiều thứ lạ không biết tên. 
Xem ra 貢白蠟 cống bạch lạp ở trong mục cống thổ sản (sản vật từ đất) thì gần như hàm ý là cống quặng. 
Trong phân tích này chúng ta tạm cho 白蠟 là thiếc.  
Hợp kim thiếc với đồng khiến cho đồng cứng hơn. Như vậy thời kỳ nhà Đường đã tiến hành khai thác Thiếc ở các mỏ lộ thiên. Nếu vậy thì khả năng 白蠟 là thiếc được dùng để cống nạp. Cũng có thể do bị áp bức mà người dân ở khu vực này đã phản kháng khởi nghĩa. 

Chúng ta đi tìm hiểu nhu cầu luyện kim vào thời kỳ này. 
Tài liệu về vị trí của các mỏ thiếc lộ thiên và sa khoáng ở Vn
https://thuvienphapluat.vn/.../Quyet-dinh-05-2008-QD-BCT...
https://hieuluat.vn/.../quyet-dinh-956-qd-ttg-thu-tuong...

Mỏ thiếc Hồ Kín ở tọa độ (19.904399, 105.324138) Thường Xuân thuộc Thanh Hoa cách Lam Kinh khoảng 9km và đều năm bên bờ sông Chu.  
Các hạt bụi núi lửa nhỏ hơn một micron, nhỏ hơn độ dày của một sợi tóc người khoảng một trăm lần. Nhưng chúng rộng hơn một chút so với bước sóng của ánh sáng đỏ, vì vậy khi bị tán xạ, chúng sẽ hấp thụ ánh sáng đỏ trong khi cho phép các màu khác đi qua. Điều này dẫn đến Mặt Trăng có màu xanh và ánh sáng mặt trời không tới được bề mặt trái đất. Như thế bụi mịn làm thay đổi nhiệt độ trên bề mặt trái đất khiến cho đồng hồ sinh học bị thay đổi. Điều này dẫn đến mất mùa và bệnh tật. 
Vào thời điểm năm 536 đến 545 đã có các đợt phun trào núi lửa với tổng sức mạnh nhiều nghìn megatonne. Chính các đợt phun trào núi lửa này đã làm suy yếu nhà Lương, là nguyên nhân sâu xa dẫn đến cuộc khởi nghĩa của Lý Bí, và sự hình thành ra nhà nước Vạn Xuân.
Cuộc khai quật được tiến hành trong khoảng thời gian từ năm 1991 đến 2007 đã khám phá 10500 bộ xương thời Trung cổ tại chợ Spitalfields ở phía đông London (Anh). Sau khi tiến hành xác định tuổi xương bằng phương pháp carbon phóng xạ, các chuyên gia của Bảo tàng Khảo cổ học London đã đi đến kết luận "đó là hài cốt của những nạn nhân trong đợt phun trào núi lửa hồi thế kỷ 13" - một trong những thảm họa núi lửa lớn nhất 10 nghìn năm qua.

Các nhà khoa học nói rằng đợt phun trào lớn đến nỗi khí sulfur đã tạo ra một tấm màn sường mù khô che phủ tầng bình lưu của trái đất, ngăn chặn ánh sáng mặt trời, thay đổi khí quyển và làm mát bề mặt trái đất, gây ra nạn đói, bệnh dịch và chết chóc. Địa điểm núi lửa chưa rõ ở đâu nhưng sự ảnh hưởng là toàn cầu và sức mạnh của đợt phun mạnh hơn gấp 8 lần so với đợt phun trào của núi Krakatoa (Indonesia) hồi năm 1883.

Krakatau là một đảo núi lửa thuộc vành đai lửa Thái Bình Dương. Cấu trúc địa lý của đảo đã thay đổi ít nhất hai lần, sau hai vụ phun trào núi lửa vào năm 535 và năm 1883.
27 tháng 8 năm 1883, vụ phun của núi lửa Krakatoa (Krakatau) có sức nổ của một quả bom 200 megatonne, giết chết hơn 36 nghìn người và làm nhiệt độ bề mặt trên toàn Trái Đất giảm trung bình 0.6°C trong nhiều tháng liên tiếp. Dư chấn của vụ nổ cũng đã tạo nên một cơn sóng thần cao tới 30m gây ra tình trạng lạnh bất thường kéo dài 4 năm sau vụ nổ. Tuyết rơi kỷ lục đã được ghi nhận trên toàn thế giới.

Vào năm 2013 tại Colle Gnifetti Glacier trên dãy núi Alps của Thụy Sĩ người ta đã khoan lấy mẫu cột băng dài 72m. Cột băng có đã ghi lại sự hiện diện trong suốt 2000 năm về tình trạng bụi bặm từ núi lửa, bão cát Sahara và các hoạt động của con người rơi xuống trung tâm châu Âu. Nhóm nghiên cứu đã dùng tia laser cắt dọc theo chiều dài cột băng ra những lát băng mỏng 120 micron, ứng một vài ngày hoặc vài tuần tuyết rơi. Mỗi lát được phân tích ra khoảng một chục thành tố. Phương pháp tiếp cận này cho phép nhóm nghiên cứu xác định các cơn bão, phun trào núi lửa và ô nhiễm bụi chì chi tiết đến từng tháng hoặc thậm chí ít hơn, trong suốt 2000 năm qua. Laura Hartman, sinh viên tốt nghiệp Đại học UM đã tìm thấy hai hạt thủy tinh núi lửa cực nhỏ trong cột băng sâu 72m này. Lớp băng ứng với thời điểm mùa xuân năm 536. Qua nghiên cứu Laura và Kurbatov nhận thấy hai hạt thủy tin trên giống như các hạt thủy tinh núi lửa được tìm thấy trước đó trong các hồ và vũng than bùn ở châu Âu và trong lõi băng ở Greenland. Nhóm nghiên cứu cho rằng từ đầu năm 536 cho tới 541 đã có nhiều đợt phun trào núi lửa tại Iceland và tro núi lửa phủ đầy Bắc Bán Cầu. Lớp tro đã làm mờ mặt Trời trong trong nhiều tháng khiến cho nhiệt độ mùa hè giảm xuống bớt 1.5°C đến 2.5°C. Mười năm từ 536 tới 545 là thời kỳ lạnh nhất trong suốt 2000 năm qua. 

Để so sánh.  Vụ phun của núi lửa Krakatoa (Krakatau) năm 1883 có sức nổ của một quả bom 200 megatonne, giết chết hơn 36 nghìn người mà nhiệt độ bề mặt trên toàn Trái Đất chỉ giảm trung bình 0.6°C trong nhiều tháng, thì có thể thấy quy mô của các đợt phun trào núi lửa từ năm 536 cho tới 541 khiến cho nhiệt độ giảm bớt từ 1.5°C đến 2.5°C trong mười năm từ 536 tới 545 lớn đến thế nào.
Kết hợp với nhà sử học Kyle Harper nhóm nghiên cứu đã tìm thấy tương ứng sự kiện thay đổi thời tiết này với những sự kiện có trong các biên niên sử. Cụ thể biên niên sử của Gaelic Ailen có ghi "Mất mùa vào năm 536". Biên niên sử của Ulster cũng có ghi "mất mùa những năm 536–539". Biên niên sử của Inisfallen có ghi “Nhiệt độ thấp, thậm chí có tuyết trong mùa hè vào tháng 8 ở Trung Quốc. Mất mùa trên diện rộng”. Vào năm 541 cho tới 543 bệnh dịch hạch “Justinian” đã giết chết 35% –55% dân số và đẩy nhanh sự sụp đổ của Đế Chế Đông La Mã. Như vậy là sự kiện núi lửa phun vào các năm 536 cho tới 541 đã để lại hậu quả là mất mùa, đói rét, dịch bệnh ở khắp các vùng phía nửa Bắc Bán Cầu như Ireland, Scandinavia, Mesopotamia và Trung Quốc.

Sự ảnh hưởng này được ghi nhận lịch sử các triều đại thay đổi liên tục
• 549-551 -- Lương Giản Văn Đế: 2 năm
• 552-555 -- Lương Nguyên Đế: 3 năm
• 555-557 -- Lương Kính Đế: 2 năm
• 555-562 -- Lương Tuyên Đế: 7 năm
• 585-587 -- Lương Hiếu Tĩnh Đế: 2 năm

Như vậy do các vụ nổ phun núi lửa Krakatau và các núi lửa vùng Iceland từ năm 536 tới 546 mà đói rét đã tàn phá và làm suy yếu Phương Bắc. Chế độ đô hộ của Phương Bắc đối với Việt Nam trở nên tàn khốc hơn. Chính do đói rét tàn phá làm suy yếu Phương Bắc mà cuộc khởi nghĩa của Lý Nam Đế đã thành công, làm sống lại dân tộc Việt Nam. Đại Việt Sử Ký toàn thư viết “Tháng Giêng năm 544, Lý Nam Đế lên ngôi vua tự xưng là Nam Việt Đế, đóng đô tại Long Biên, dựng quốc hiệu là Vạn Xuân”. Cuộc khởi nghĩa của Lý Nam Đế bắt đầu từ năm 541, là thời điểm Nhà Lương bị mất mùa vì thời tiết thay đổi cục bộ do bụi tro núi lửa ở Bắc Âu. Phải 4 năm sau, mãi tới năm 545 nhà Lương mới điều được quân sang trấn áp. Tuy nhiên tới năm 550 đội quân Nhà Lương này đã bị đánh bại. Nhà nước Vạn Xuân tồn tại được khoảng 70 năm cho tới năm 602.

Dịch bệnh và mất mùa khiến Nhà Lương sụp đổ. Nhà Tùy lên thay, đưa quân sang đánh chiếm Vạn Xuân. Do ở xa khu vực núi lửa phun mà vào đầu những năm 600 kinh tế Trung Quốc đã hồi phục.  Kinh tế thế giới đình trệ đến tận năm 640 mới có tín hiệu hồi phục. Tín hiệu hồi phục là việc tìm thấy bụi chì tăng đột biến trong lõi băng, đánh dấu sự hồi sinh của hoạt động khai thác bạc làm tiền tệ. Đỉnh chì thứ hai, vào năm 660, đánh dấu việc sự gia tăng của thương mại. Việc sử dụng bạc với số lượng lớn cho thấy quy mô giao thương toàn cầu là lớn. Hai pho tượng Phật khổng lồ tại Bamiyan, nằm trên tuyến đường độc đạo giữa các dãy núi cao 4000m, nối liên Trung Á với Ấn Độ. Với quy mô và kích cỡ hai pho tượng, pho tượng cao 58m – tạc năm 507 – trước thời kỳ núi lửa phun, và pho tượng cao 38m – tạc năm 554 – sau khi kinh tế thế giới đã hồi phục, cho thấy song song với mở rộng giao thương buôn bán toàn cầu là sự bành trướng tôn giáo.
Lượng chì có trong không khí là chỉ số cho thấy gành luyện kim trên thế giới hồi phục. 
https://agupubs.onlinelibrary.wiley.com/.../2017GH000064

Như thế rất có thể do sự bóc lột của nhà Đường đã dẫn tới cuộc khởi nghĩa của Mai Thúc Loan. 
Tôi rất muốn khảo sát lại các sự kiện lịch sử trong khoảng thời gian từ năm 700 cho tới trước năm 1000. Tôi cho rằng dòng họ của các đời vua trong khoảng thời gian này tương đối ổn định, vì sự kiện tiêu diệt lẫn nhau gần như là không có. Như thế vùng đất nơi Đại Việt Sử Ký Toàn Thư ghi nhận là nơi phát tích một dòng vua sẽ xuất hiện mật độ dòng họ của vua là lớn nhất. Do có sự di dân nên tỷ lệ dòng họ ở vùng đất phía Nam mang tính trung bình. Do văn hóa làng xã nên, ngoại trừ Hà Nội, tỷ lệ dòng họ ở các vùng miền Bắc là rất ổn định. 

Đây là các sự liện liên quan tới các họ như Mai, Khúc, Dương, Kiều, Ngô, Đinh, Đỗ...   
A. Phần định danh. 
Và xã Đường Lâm ở Sơn Tây ngày nay là một địa danh mới chỉ xuất hiện sau 1945 trên cơ sở hợp nhất một số làng của tổng Cam Thịnh, còn Đường Lâm cổ - năm 669 thời Đường Cao Tông, cùng với 2 huyện An Viễn và Phúc Lộc thuộc châu Phúc Lộc, 757 thời Đường Túc Tông đổi thành quận Đường Lâm, 758 bỏ quận lập lại châu Phúc Lộc - thuộc vùng tây nam Châu Ái. "Tân Đường Thư" có ghi: trong tất cả các châu, quận An Nam chỉ có 2 vùng cống nạp bạch lạp (thiếc trắng) là Phong Châu và Đường Lâm. Từ Đèo Ngang trở ra chỉ có hai vùng có mỏ thiếc sa khoáng là Tuyên Quang (đời Đường thuộc Phong Châu) và mỏ thiếc Bù Me, gần núi Bù Chò thuộc các huyện Thường Xuân, Thọ Xuân (Tây Nam Thanh Hóa), một phần ăn sang Quỳ Hợp, Quế Phong miền Tây Nghệ An.
Xét về khả năng chỉ có vùng Tuyên Quang - Thái Nguyên và Thanh Hóa - Nghệ An có thể là Đường Lâm. 

A. Phần Sử Liệu

Đoạn viết sau là thể hiện của Đại Việt Sử Ký Toàn Thư.

Họ Mai Hắc Đế
Mai Thúc Loan 670 - 722, thôn Ngọc Trừng, Hoan Châu (nay thuộc huyện Nam Đàn, Nghệ An). Theo Việt điện u linh, cha của Mai Thúc Loan là Mai Hoàn, mẹ là Mai An Hòa nguyên gốc Lộc Hà, Hà Tĩnh, lưu lạc sang vùng Nam Đàn, Nghệ An. Theo sách Việt sử tiêu án, Mai Thúc Loan là người làng Hương Lãm, huyện Nam Đường, nay là thị trấn Nam Đàn, tỉnh Nghệ An, dân lập đền thờ ông ở thôn chợ Sa Nam. 
Năm 722, Mai Thúc Loan đánh Tống Bình (Hà Nội nay) xưng là Hắc Đế, bên ngoài liên kết với người Lâm Ấp, Chân Lạp, số quân nói là 30 vạn. Vua Đường sai nội thị tả giám môn vệ tướng quân là Dương Tư Húc và Đô hộ là Quang Sở Khách đánh dẹp yên được.

Họ Trương, Họ Cao.
Thành nằm ở vị trí giữa Thành Hà Nội và sông Tô Lịch, thuộc quận Ba Đình của Hà Nội hiện nay. Đại La ban đầu do Trương Bá Nghi đắp vào năm 767 và được tu bổ Triệu Xương năm 791, Trương Chu 824, Lý Nguyên Gia dời phủ trị tới bên sông Tô Lịch, đắp một cái thành nhỏ, gọi là La Thành. La Thành được Cao Biền cho đắp lại to lớn hơn. Theo sử cũ thì La Thành do Cao Biền cho đắp có chu vi 6.6km; cao 8.67m, chân thành rộng 8.33m.

Họ Phùng 
Năm 791, Phùng Hưng dấy binh vây đánh An Nam đô hộ phủ Cao Chính Bình. Phùng Hưng là người ở Đường Lâm thuộc huyện Phúc Lộc Giao Châu (Nay là xã Cam Lâm, huyện Ba Vì, tỉnh Hà Tây.)

Họ Ngô 
"Ngô Quyền sinh ngày 12 tháng 3 năm Đinh Tỵ (17 tháng 4 năm 898) trong một dòng họ hào trưởng có thế lực ở châu Đường Lâm, Ái Châu. Cha là Ngô Mân làm chức châu mục Đường Lâm."
"Một hào trưởng người Ái Châu (thuộc Thanh Hóa ngày nay) là Dương Đình Nghệ nuôi 3000 con nuôi, mưu đồ khôi phục. Ngô Quyền lớn lên làm nha tướng cho Dương Đình Nghệ, được Dương Đình Nghệ gả con gái cho và giao quyền cai quản Ái châu, đất bản bộ của họ Dương. Năm 931, Dương Đình Nghệ phát binh từ Thanh Hóa ra Bắc đánh đuổi quân Nam Hán, đánh bại Lý Tiến và quân cứu viện do Trần Bảo chỉ huy, chiếm giữ bờ cõi nước Việt, xưng là Tiết độ sứ. Năm 937, hào trưởng đất Phong Châu là Kiều Công Tiễn sát hại Dương Đình Nghệ, trở thành vị Tĩnh Hải quân Tiết độ sứ cuối cùng trong thời kì Tự chủ. Nhưng Công Tiễn lại không có chỗ dựa chính trị vững chắc, hành động tranh giành quyền lực của ông bị phản đối bởi nhiều thế lực địa phương và thậm chí nội bộ họ Kiều cũng chia rẽ trầm trọng. Bị cô lập, Công Tiễn vội vã cầu cứu nhà Nam Hán. Ngô Quyền nhanh chóng tập hợp lực lượng, kéo quân ra Bắc, giết chết Kiều Công Tiễn rồi chuẩn bị quyết chiến với quân Nam Hán. Thắng lợi của Ngô Quyền trên sông Bạch Đằng vào năm 938 đã đặt dấu chấm hết cho mọi âm mưu xâm lược Tĩnh Hải quân của nhà Nam Hán, đồng thời cũng kết thúc thời kì Bắc thuộc của Việt Nam. Năm 939, Ngô Quyền xưng vương, đóng đô ở Cổ Loa, lập ra nhà Ngô. Ngô Vương qua đời ở tuổi 47, trị vì được 6 năm. Sau cái chết của ông, nhà Ngô suy yếu nhanh chóng, không khống chế được các thế lực cát cứ địa phương và sụp đổ vào năm 965."

B. Phần phân tích phân bố dòng họ. 
Ở phần này chúng ta sử dụng CSDL về dòng họ trong số học sinh phổ thông của cả nước để truy tìm nơi phát tích của các dòng họ cổ xưa. Việc phân tích được thực hiện thông qua tỷ lệ phần trăm của các họ trong khu vực.
Chúng ta theo dõi dòng họ Dương thì thấy tâm mật độ dòng họ cao nhất là ở vùng Thái Nguyên và giảm dần theo khoảng cách tới tâm tăng lên. 

Họ Mai (Mai Hắc Đế 670 - 722)
Toàn quốc 0.86%, Miền Bắc 0.59%, Miền Trung 1.03%, Miền Nam 0.93%, Thái Nguyên 0.49%, Vĩnh Phúc 0.14%, Hà Nam 0.48%, Hưng Yên 0.5%, Hà Nội 0.36%, Ninh Bình 1.47%, Tuyên Quang 0.26%, Phú Thọ 0.44%, Hải Dương 0.38%, Nam Định 2.0%, Hòa Bình 0.14%, Thanh Hóa 2.4%, Nghệ An 0.38%, Đồng Nai 1.24%.
Kết hợp với sử liệu chúng ta thấy nơi phát tích dòng họ Mai, cụ thể là Mai Hắc Đế có thể là ở vùng từ Thanh Hóa tới Nam Định. 

Họ Dương (Dương Đình Nghệ 874 – 937)
Toàn quốc 1.4%, ở Miền Bắc là 1.65, Miền Trung 1.1%, Miền Nam 1.49, Thái Nguyên 6.19%, Vĩnh Phúc 2.69%, Hà Nam 1.8%, Hưng Yên 1.6%, Hà Nội 1.58%, Ninh Bình 1.34%, Tuyên Quang 1.4%, Phú Thọ 0.95%, Hải Dương 0.88%, Nam Định 0.68%, Hòa Bình 0.61%, Thanh Hóa 0.76%. Nghệ An 0.68%.
Dòng họ Dương có thể là ở vùng Thái Nguyên - Vĩnh Phúc. 
Vậy Đường Lâm <=> Tuyên Quang - Thái Nguyên 

Họ Ngô (Ngô Quyền 898-944)
Toàn quốc 1.66%, Miền Bắc là 1.7%, Miền Trung 1.64%, Miền Nam 1.49%, Thái Nguyên 2.24%, Hà Nội 2.14%, Vĩnh Phúc 1.48%, Hà Nam 2.21%, Hưng Yên 1.47%, Ninh Bình 0.91, Tuyên Quang 0.84, Phú Thọ 1.23%, Hải Dương 1.34%, Nam Định 2.2%, Hòa Bình 0.44%, Thanh Hóa 1.19%. 
Dòng họ Ngô có thể ở vùng thuộc tam giác Thái Nguyên - Hà Nội - Hà Nam. 
Đường Lâm <=> Tuyên Quang - Thái Nguyên 
Khả năng Ngô Quyền là người vùng Đường Lâm (Thái Nguyên) là rất lớn. Như thế việc Dương Đình Nghệ ở vùng đất Thanh Hóa xem ra không hợp lắm. Kết hợp thống kê lại với nhau chúng ta có thể nhận thấy có khả năng cả hai ông Dương Đình Nghệ và Ngô Quyền đều ở vùng đất Thái Nguyên.  

Vậy rõ ràng ở đây có một yếu tố gì đó, hoặc là Đại Việt Sử Ký Toàn Thư đã có sai sót về địa danh, hoặc là đã có một sự kiện chưa rõ nào đó.
Cấu trúc Làng Xã rất ổn định, việc cưỡng chế các vùng dân cư có tính lịch sử nhập vào với Hà Nội gây ra rất nhiều rắc rối cho thống kê này. Nếu có được phân bố chi tiết hơn tới Huyện thì chúng ta có thể nhận ra được vết của lịch sử.
Có bạn nào có dữ liệu thì cho tôi xin.
"Trong tất cả các châu, quận An Nam chỉ có 2 vùng cống nạp bạch lạp (thiếc trắng) là Phong Châu và Đường Lâm". 

Từ Đèo Ngang trở ra chỉ có hai vùng có mỏ thiếc sa khoáng là Tuyên Quang (đời Đường thuộc Phong Châu) và mỏ thiếc Bù Me, gần núi Bù Chò thuộc các huyện Thường Xuân, Thọ Xuân (Tây Nam Thanh Hóa), một phần ăn sang Quỳ Hợp, Quế Phong miền Tây Nghệ An.
Sơn Dương (Tuyên Quang) và Đại Từ (Thái Nguyên) là những vùng có nhiều mỏ thiếc lộ thiên. Nếu các dữ liệu chi tiết về dòng họ Ngô và Dương mà tạo ra phân bố với các tâm điểm ở hai vùng có mỏ thiếc, phía Thái Nguyên và Thanh Hóa, thì có thể phải xem lại vị trí của Đường Lâm nay.

Đường Lâm ở Sơn Tây ngày nay là một địa danh mới chỉ xuất hiện sau 1945 trên cơ sở hợp nhất một số làng của tổng Cam Thịnh, còn Đường Lâm cổ - năm 669 thời Đường Cao Tông, cùng với 2 huyện An Viễn và Phúc Lộc thuộc châu Phúc Lộc, 757 thời Đường Túc Tông đổi thành quận Đường Lâm, 758 bỏ quận lập lại châu Phúc Lộc - thuộc vùng tây nam Châu Ái. "Tân Đường Thư" có ghi: trong tất cả các châu, quận An Nam chỉ có 2 vùng cống nạp bạch lạp (thiếc trắng) là Phong Châu và Đường Lâm. Từ Đèo Ngang trở ra chỉ có hai vùng có mỏ thiếc sa khoáng là Tuyên Quang (đời Đường thuộc Phong Châu) và mỏ thiếc Bù Me, gần núi Bù Chò thuộc các huyện Thường Xuân, Thọ Xuân (Tây Nam Thanh Hóa), một phần ăn sang Quỳ Hợp, Quế Phong miền Tây Nghệ An.

Họ Dương đến Dương Đình Nghệ đã nhiều đời làm hào trưởng ở đất Dương Xá, Ái Châu. Khởi tổ họ Ngô là Ngô Nhật Đại quê ở Ái Châu, tham gia khởi nghĩa Mai Thúc Loan, khởi nghĩa thất bại quay về Ái Châu lập nghiệp, 5 đời sau sinh ra Ngô Quyền. Quê của Ngô Quyền cách quê của Dương Đình Nghệ chỉ khoảng 40km theo đường sông Chu, họ Ngô nhiều đời là châu mục khống chế cả một vùng biên viễn ngay sau lưng họ Dương, điều này lý giải vì sao Ngô Quyền quê ở Đường Lâm lại lấy con gái Dương Đình Nghệ, quê Dương Xá và được Dương Đình Nghệ tin tưởng giao luôn binh quyền ở Ái Châu, sau mới đem quân từ Ái Châu ra Đại La diệt Kiều Công Tiễn. Đinh Bộ Lĩnh, Lê Hoàn đều là cháu rể Dương Đình Nghệ.

Vậy có thể đưa ra kết luận "Các cuộc khởi nghĩa dẫn đến việc thiết lập các triều đại Vua ở Đại Việt liên quan tới việc chống lại sự áp bức bóc lột của phương Bắc trong việc khai mỏ thiếc". Tuy nhiên chúng ta cần phải có bằng chứng về việc khai thác thiếc vào thời kỳ từ năm 700 cho tới 900. Liệu có thể tìm ra được dấu vết khai mỏ không?

### Phân bố tỉ lệ

```{r}
mai_sf <- dat_sf %>% mutate(prop.mai=(sum(subset(., Ho=="Mai")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Mai")
mai_plot <- mai_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.mai, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=mai_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(mai_plot$prop.mai[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Mai")
```

### Phân bố mật độ

```{r}
mai_sff <- dat_sff %>% mutate(prop.mai=(sum(subset(., Ho=="Mai")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Mai")
mai_plotf <- mai_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.mai, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=mai_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(mai_plotf$prop.mai[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Mai")
```

## Phùng

Phùng (馮) là một họ cổ. Nó đứng thứ 27 trong danh sách các họ ở Trung Quốc đại lục ngày nay. 

Họ Phùng có nguồn gốc xa xưa là dân du mục ở Tân Cương. Vào khoảng 4000 năm về trước họ Phùng xuất hiện ở vùng Thiểm Tây như một quốc gia. 
https://www.newton.com.tw/wiki/%E9%A6%AE%E5%A7%93
https://kknews.cc/history/qq4j2r.html

Có thể đã có một dòng người di cư vào khoảng hơn 3000 năm về trước theo dòng sông Thao về tới được khu vực mà nay là Phùng Nguyên. Có lẽ Phùng Nguyên là nơi được coi là phát tích của họ Phùng. 

3000 năm về trước, Phùng Nguyên là một cái gò nhỏ ở cuối sông Thao trước khi gặp sông Đà. Theo thời gian do phù sa bồi lấp mà Phùng Nguyên trở thành đất liền. Ở đây người ta tìm thấy các di vật Nha Chương.

Dựa theo phân tích của Đức Dư về dòng họ ở Việt Nam 
https://duhongduc.shinyapps.io/HoViet/...
chúng ta có thể nhận thấy họ Phùng ở khu vực ngay chân núi Ba Vì. Đây là vùng đất cổ và là nơi các cơn mưa từ Ba Vì đổ xuống gây ngập lụt. Đó có thể là cội nguồn của truyền thuyết Sơn Tinh Thủy Tinh. 

Chúng ta có thể nhận thấy dòng họ Phùng chiếm vị trí sâu về phía chân núi, sau đó là họ Lý ở dải đất gần với biển hơn kéo dài từ vùng Đền Đô qua Từ Liêm, tiếp sau nữa là nhà Trần. 

Đây có thể là sự hình thành ra cấu trúc không gian văn hóa vua Hùng (phụ hệ) trong tổng thể văn hóa mẫu hệ ở đồng bằng Bắc Bộ. 

### Phân bố tỉ lệ

```{r}
# library(plotly)

phung_sf <- dat_sf %>% mutate(prop.phung=(sum(subset(., Ho=="Phùng")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Phùng")
phung_plot <- phung_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.phung, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=phung_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(phung_plot$prop.phung[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Phùng")

# fig <- ggplotly(
#   ggplot(bui_plot) +
#     geom_sf(aes(fill = pro.pop), lwd=0) +
#     # geom_sf(data=river3, col="white") +
#     scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
#     annotate(geom="text", x=108, y=23, color="red", label= paste(round(bui_plot$prop.bui[1],1), "% dân số", sep = "")) +
#     theme_bw()
# )
# 
# fig
```

### Phân bố mật độ

```{r}
phung_sff <- dat_sff %>% mutate(prop.phung=(sum(subset(., Ho=="Phùng")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Phùng")
phung_plotf <- phung_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.phung, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=phung_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(phung_plotf$prop.phung[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Phùng")
```

## A 

### Phân bố tỉ lệ

```{r}
a_sf <- dat_sf %>% mutate(prop.a=(sum(subset(., Ho=="A")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="A")
a_plot <- a_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.a, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=a_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(a_plot$prop.a[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("A")
```

### Phân bố mật độ

```{r}
a_sff <- dat_sff %>% mutate(prop.a=(sum(subset(., Ho=="A")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="A")
a_plotf <- a_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.a, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=a_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(a_plotf$prop.a[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("A")
```

## An

### Phân bố tỉ lệ

```{r}
an_sf <- dat_sf %>% mutate(prop.an=(sum(subset(., Ho=="An")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="An")
an_plot <- an_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.an, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=an_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(an_plot$prop.an[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("An")
```

### Phân bố mật độ

```{r}
an_sff <- dat_sff %>% mutate(prop.an=(sum(subset(., Ho=="An")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="An")
an_plotf <- an_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.an, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=an_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(an_plotf$prop.an[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("An")
```

## Âu

### Phân bố tỉ lệ

```{r}
au_sf <- dat_sf %>% mutate(prop.au=(sum(subset(., Ho=="Âu")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Âu")
au_plot <- au_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.au, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=au_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(au_plot$prop.au[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Âu")
```

### Phân bố mật độ

```{r}
au_sff <- dat_sff %>% mutate(prop.au=(sum(subset(., Ho=="Âu")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Âu")
au_plotf <- au_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.au, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=au_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(au_plotf$prop.au[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Âu")
```

## Bạc

### Phân bố tỉ lệ

```{r}
bac_sf <- dat_sf %>% mutate(prop.bac=(sum(subset(., Ho=="Bạc")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Bạc")
bac_plot <- bac_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.bac, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=bac_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(bac_plot$prop.bac[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Bạc")
```

### Phân bố mật độ

```{r}
bac_sff <- dat_sff %>% mutate(prop.bac=(sum(subset(., Ho=="Bạc")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Bạc")
bac_plotf <- bac_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.bac, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=bac_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(bac_plotf$prop.bac[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Bạc")
```

## Bạch

### Phân bố tỉ lệ

```{r}
bach_sf <- dat_sf %>% mutate(prop.bach=(sum(subset(., Ho=="Bạch")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Bạch")
bach_plot <- bach_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.bach, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=bach_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(bach_plot$prop.bach[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Bạch")
```

### Phân bố mật độ

```{r}
bach_sff <- dat_sff %>% mutate(prop.bach=(sum(subset(., Ho=="Bạch")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Bạch")
bach_plotf <- bach_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.bach, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=bach_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(bach_plotf$prop.bach[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Bạch")
```

## Bàn

### Phân bố tỉ lệ

```{r}
ban_sf <- dat_sf %>% mutate(prop.ban=(sum(subset(., Ho=="Bàn")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Bàn")
ban_plot <- ban_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.ban, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=ban_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(ban_plot$prop.ban[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Bàn")
```

### Phân bố mật độ

```{r}
ban_sff <- dat_sff %>% mutate(prop.ban=(sum(subset(., Ho=="Bàn")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Bàn")
ban_plotf <- ban_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.ban, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=ban_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(ban_plotf$prop.ban[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Bàn")
```

## Bành

### Phân bố tỉ lệ

```{r}
banh_sf <- dat_sf %>% mutate(prop.banh=(sum(subset(., Ho=="Bành")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Bành")
banh_plot <- banh_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.banh, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=banh_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(banh_plot$prop.banh[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Bành")
```

### Phân bố mật độ

```{r}
banh_sff <- dat_sff %>% mutate(prop.banh=(sum(subset(., Ho=="Bành")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Bành")
banh_plotf <- banh_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.banh, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=banh_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(banh_plotf$prop.banh[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Bành")
```

## Bế

### Phân bố tỉ lệ

```{r}
be_sf <- dat_sf %>% mutate(prop.be=(sum(subset(., Ho=="Bế")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Bế")
be_plot <- be_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.be, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=be_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(be_plot$prop.be[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Bế")
```

### Phân bố mật độ

```{r}
be_sff <- dat_sff %>% mutate(prop.be=(sum(subset(., Ho=="Bế")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Bế")
be_plotf <- be_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.be, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=be_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(be_plotf$prop.be[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Bế")
```

## Biện

### Phân bố tỉ lệ

```{r}
bien_sf <- dat_sf %>% mutate(prop.bien=(sum(subset(., Ho=="Biện")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Biện")
bien_plot <- bien_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.bien, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=bien_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(bien_plot$prop.bien[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Biện")
```

### Phân bố mật độ

```{r}
bien_sff <- dat_sff %>% mutate(prop.bien=(sum(subset(., Ho=="Biện")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Biện")
bien_plotf <- bien_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.bien, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=bien_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(bien_plotf$prop.bien[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Biện")
```

## Bùi

### Phân bố tỉ lệ

```{r}
bui_sf <- dat_sf %>% mutate(prop.bui=(sum(subset(., Ho=="Bùi")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Bùi")
bui_plot <- bui_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.bui, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=bui_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(bui_plot$prop.bui[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Bùi")
```

### Phân bố mật độ

```{r}
bui_sff <- dat_sff %>% mutate(prop.bui=(sum(subset(., Ho=="Bùi")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Bùi")
bui_plotf <- bui_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.bui, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=bui_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(bui_plotf$prop.bui[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Bùi")
```

## Cà

### Phân bố tỉ lệ

```{r}
ca_sf <- dat_sf %>% mutate(prop.ca=(sum(subset(., Ho=="Cà")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Cà")
ca_plot <- ca_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.ca, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=ca_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(ca_plot$prop.ca[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Cà")
```

### Phân bố mật độ

```{r}
ca_sff <- dat_sff %>% mutate(prop.ca=(sum(subset(., Ho=="Cà")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Cà")
ca_plotf <- ca_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.ca, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=ca_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(ca_plotf$prop.ca[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Cà")
```

## Cầm

### Phân bố tỉ lệ

```{r}
cam_sf <- dat_sf %>% mutate(prop.cam=(sum(subset(., Ho=="Cầm")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Cầm")
cam_plot <- cam_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.cam, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=cam_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(cam_plot$prop.cam[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Cầm")
```

### Phân bố mật độ

```{r}
cam_sff <- dat_sff %>% mutate(prop.cam=(sum(subset(., Ho=="Cầm")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Cầm")
cam_plotf <- cam_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.cam, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=cam_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(cam_plotf$prop.cam[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Cầm")
```

## Cấn

### Phân bố tỉ lệ

```{r}
can_sf <- dat_sf %>% mutate(prop.can=(sum(subset(., Ho=="Cấn")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Cấn")
can_plot <- can_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.can, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=can_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(can_plot$prop.can[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Cấn")
```

### Phân bố mật độ

```{r}
can_sff <- dat_sff %>% mutate(prop.can=(sum(subset(., Ho=="Cấn")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Cấn")
can_plotf <- can_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.can, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=can_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(can_plotf$prop.can[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Cấn")
```

## Cao

### Phân bố tỉ lệ

```{r}
cao_sf <- dat_sf %>% mutate(prop.cao=(sum(subset(., Ho=="Cao")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Cao")
cao_plot <- cao_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.cao, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=cao_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(cao_plot$prop.cao[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Cao")
```

### Phân bố mật độ

```{r}
cao_sff <- dat_sff %>% mutate(prop.cao=(sum(subset(., Ho=="Cao")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Cao")
cao_plotf <- cao_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.cao, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=cao_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(cao_plotf$prop.cao[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Cao")
```

## Chang

### Phân bố tỉ lệ

```{r}
chang_sf <- dat_sf %>% mutate(prop.chang=(sum(subset(., Ho=="Chang")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Chang")
chang_plot <- chang_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.chang, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=chang_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(chang_plot$prop.chang[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Chang")
```

### Phân bố mật độ

```{r}
chang_sff <- dat_sff %>% mutate(prop.chang=(sum(subset(., Ho=="Chang")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Chang")
chang_plotf <- chang_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.chang, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=chang_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(chang_plotf$prop.chang[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Chang")
```

## Chảo

### Phân bố tỉ lệ

```{r}
chao_sf <- dat_sf %>% mutate(prop.chao=(sum(subset(., Ho=="Chảo")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Chảo")
chao_plot <- chao_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.chao, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=chao_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(chao_plot$prop.chao[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Chảo")
```

### Phân bố mật độ

```{r}
chao_sff <- dat_sff %>% mutate(prop.chao=(sum(subset(., Ho=="Chảo")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Chảo")
chao_plotf <- chao_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.chao, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=chao_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(chao_plotf$prop.chao[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Chảo")
```

## Châu

### Phân bố tỉ lệ

```{r}
chau_sf <- dat_sf %>% mutate(prop.chau=(sum(subset(., Ho=="Châu")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Châu")
chau_plot <- chau_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.chau, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=chau_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(chau_plot$prop.chau[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Châu")
```

### Phân bố mật độ

```{r}
chau_sff <- dat_sff %>% mutate(prop.chau=(sum(subset(., Ho=="Châu")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Châu")
chau_plotf <- chau_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.chau, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=chau_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(chau_plotf$prop.chau[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Châu")
```

## Chế

### Phân bố tỉ lệ

```{r}
che_sf <- dat_sf %>% mutate(prop.che=(sum(subset(., Ho=="Chế")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Chế")
che_plot <- che_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.che, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=che_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(che_plot$prop.che[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Chế")
```

### Phân bố mật độ

```{r}
che_sff <- dat_sff %>% mutate(prop.che=(sum(subset(., Ho=="Chế")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Chế")
che_plotf <- che_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.che, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=che_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(che_plotf$prop.che[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Chế")
```

## Chìu

### Phân bố tỉ lệ

```{r}
chiu_sf <- dat_sf %>% mutate(prop.chiu=(sum(subset(., Ho=="Chìu")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Chìu")
chiu_plot <- chiu_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.chiu, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=chiu_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(chiu_plot$prop.chiu[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Chìu")
```

### Phân bố mật độ

```{r}
chiu_sff <- dat_sff %>% mutate(prop.chiu=(sum(subset(., Ho=="Chìu")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Chìu")
chiu_plotf <- chiu_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.chiu, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=chiu_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(chiu_plotf$prop.chiu[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Chìu")
```

## Chu

### Phân bố tỉ lệ

```{r}
chu_sf <- dat_sf %>% mutate(prop.chu=(sum(subset(., Ho=="Chu")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Chu")
chu_plot <- chu_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.chu, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=chu_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(chu_plot$prop.chu[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Chu")
```

### Phân bố mật độ

```{r}
chu_sff <- dat_sff %>% mutate(prop.chu=(sum(subset(., Ho=="Chu")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Chu")
chu_plotf <- chu_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.chu, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=chu_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(chu_plotf$prop.chu[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Chu")
```

## Chử

### Phân bố tỉ lệ

```{r}
chu2_sf <- dat_sf %>% mutate(prop.chu2=(sum(subset(., Ho=="Chử")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Chử")
chu2_plot <- chu2_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.chu2, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=chu2_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(chu2_plot$prop.chu2[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Chử")
```

### Phân bố mật độ

```{r}
chu2_sff <- dat_sff %>% mutate(prop.chu2=(sum(subset(., Ho=="Chử")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Chử")
chu2_plotf <- chu2_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.chu2, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=chu2_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(chu2_plotf$prop.chu2[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Chử")
```

## Cù

### Phân bố tỉ lệ

```{r}
cu_sf <- dat_sf %>% mutate(prop.cu=(sum(subset(., Ho=="Cù")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Cù")
cu_plot <- cu_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.cu, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=cu_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(cu_plot$prop.cu[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Cù")
```

### Phân bố mật độ

```{r}
cu_sff <- dat_sff %>% mutate(prop.cu=(sum(subset(., Ho=="Cù")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Cù")
cu_plotf <- cu_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.cu, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=cu_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(cu_plotf$prop.cu[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Cù")
```

## Cư

### Phân bố tỉ lệ

```{r}
cu2_sf <- dat_sf %>% mutate(prop.cu2=(sum(subset(., Ho=="Cư")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Cư")
cu2_plot <- cu2_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.cu2, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=cu2_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(cu2_plot$prop.cu2[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Cư")
```

### Phân bố mật độ

```{r}
cu2_sff <- dat_sff %>% mutate(prop.cu2=(sum(subset(., Ho=="Cư")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Cư")
cu2_plotf <- cu2_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.cu2, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=cu2_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(cu2_plotf$prop.cu2[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Cư")
```

## Cứ

### Phân bố tỉ lệ

```{r}
cu1_sf <- dat_sf %>% mutate(prop.cu1=(sum(subset(., Ho=="Cứ")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Cứ")
cu1_plot <- cu1_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.cu1, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=cu1_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(cu1_plot$prop.cu1[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Cứ")
```

### Phân bố mật độ

```{r}
cu1_sff <- dat_sff %>% mutate(prop.cu1=(sum(subset(., Ho=="Cứ")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Cứ")
cu1_plotf <- cu1_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.cu1, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=cu1_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(cu1_plotf$prop.cu1[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Cứ")
```

## Đàm

### Phân bố tỉ lệ

```{r}
dam_sf <- dat_sf %>% mutate(prop.dam=(sum(subset(., Ho=="Đàm")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đàm")
dam_plot <- dam_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.dam, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=dam_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(dam_plot$prop.dam[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Đàm")
```

### Phân bố mật độ

```{r}
dam_sff <- dat_sff %>% mutate(prop.dam=(sum(subset(., Ho=="Đàm")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đàm")
dam_plotf <- dam_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.dam, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=dam_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(dam_plotf$prop.dam[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Đàm")
```

## Đặng

### Phân bố tỉ lệ

```{r}
dang_sf <- dat_sf %>% mutate(prop.dang=(sum(subset(., Ho=="Đặng")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đặng")
dang_plot <- dang_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.dang, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=dang_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(dang_plot$prop.dang[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Đặng")
```

### Phân bố mật độ

```{r}
dang_sff <- dat_sff %>% mutate(prop.dang=(sum(subset(., Ho=="Đặng")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đặng")
dang_plotf <- dang_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.dang, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=dang_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(dang_plotf$prop.dang[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Đặng")
```

## Danh

### Phân bố tỉ lệ

```{r}
danh_sf <- dat_sf %>% mutate(prop.danh=(sum(subset(., Ho=="Danh")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Danh")
danh_plot <- danh_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.danh, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=danh_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(danh_plot$prop.danh[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Danh")
```

### Phân bố mật độ

```{r}
danh_sff <- dat_sff %>% mutate(prop.danh=(sum(subset(., Ho=="Danh")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Danh")
danh_plotf <- danh_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.danh, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=danh_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(danh_plotf$prop.danh[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Danh")
```

## Đào

### Phân bố tỉ lệ

```{r}
dao_sf <- dat_sf %>% mutate(prop.dao=(sum(subset(., Ho=="Đào")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đào")
dao_plot <- dao_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.dao, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=dao_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(dao_plot$prop.dao[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Đào")
```

### Phân bố mật độ

```{r}
dao_sff <- dat_sff %>% mutate(prop.dao=(sum(subset(., Ho=="Đào")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đào")
dao_plotf <- dao_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.dao, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=dao_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(dao_plotf$prop.dao[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Đào")
```

## Đậu

### Phân bố tỉ lệ

```{r}
dau_sf <- dat_sf %>% mutate(prop.dau=(sum(subset(., Ho=="Đậu")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đậu")
dau_plot <- dau_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.dau, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=dau_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(dau_plot$prop.dau[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Đậu")
```

### Phân bố mật độ

```{r}
dau_sff <- dat_sff %>% mutate(prop.dau=(sum(subset(., Ho=="Đậu")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đậu")
dau_plotf <- dau_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.dau, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=dau_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(dau_plotf$prop.dau[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Đậu")
```

## Diệp

### Phân bố tỉ lệ

```{r}
diep_sf <- dat_sf %>% mutate(prop.diep=(sum(subset(., Ho=="Diệp")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Diệp")
diep_plot <- diep_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.diep, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=diep_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(diep_plot$prop.diep[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Diệp")
```

### Phân bố mật độ

```{r}
diep_sff <- dat_sff %>% mutate(prop.diep=(sum(subset(., Ho=="Diệp")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Diệp")
diep_plotf <- diep_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.diep, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=diep_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(diep_plotf$prop.diep[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Diệp")
```

## Điêu

### Phân bố tỉ lệ

```{r}
dieu_sf <- dat_sf %>% mutate(prop.dieu=(sum(subset(., Ho=="Điêu")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Điêu")
dieu_plot <- dieu_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.dieu, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=dieu_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(dieu_plot$prop.dieu[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Điêu")
```

### Phân bố mật độ

```{r}
dieu_sff <- dat_sff %>% mutate(prop.dieu=(sum(subset(., Ho=="Điêu")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Điêu")
dieu_plotf <- dieu_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.dieu, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=dieu_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(dieu_plotf$prop.dieu[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Điêu")
```

## Điểu

### Phân bố tỉ lệ

```{r}
dieu2_sf <- dat_sf %>% mutate(prop.dieu2=(sum(subset(., Ho=="Điểu")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Điểu")
dieu2_plot <- dieu2_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.dieu2, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=dieu2_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(dieu2_plot$prop.dieu2[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Điểu")
```

### Phân bố mật độ

```{r}
dieu2_sff <- dat_sff %>% mutate(prop.dieu2=(sum(subset(., Ho=="Điểu")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Điểu")
dieu2_plotf <- dieu2_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.dieu2, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=dieu2_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(dieu2_plotf$prop.dieu2[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Điểu")
```

## Đinh

### Phân bố tỉ lệ

```{r}
dinh_sf <- dat_sf %>% mutate(prop.dinh=(sum(subset(., Ho=="Đinh")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đinh")
dinh_plot <- dinh_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.dinh, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=dinh_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(dinh_plot$prop.dinh[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Đinh")
```

### Phân bố mật độ

```{r}
dinh_sff <- dat_sff %>% mutate(prop.dinh=(sum(subset(., Ho=="Đinh")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đinh")
dinh_plotf <- dinh_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.dinh, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=dinh_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(dinh_plotf$prop.dinh[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Đinh")
```

## Đô

### Phân bố tỉ lệ

```{r}
do1_sf <- dat_sf %>% mutate(prop.do1=(sum(subset(., Ho=="Đô")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đô")
do1_plot <- do1_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.do1, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=do1_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(do1_plot$prop.do1[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Đô")
```

### Phân bố mật độ

```{r}
do1_sff <- dat_sff %>% mutate(prop.do1=(sum(subset(., Ho=="Đô")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đô")
do1_plotf <- do1_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.do1, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=do1_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(do1_plotf$prop.do1[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Đô")
```

## Đỗ

### Phân bố tỉ lệ

```{r}
do_sf <- dat_sf %>% mutate(prop.do=(sum(subset(., Ho=="Đỗ")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đỗ")
do_plot <- do_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.do, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=do_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(do_plot$prop.do[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Đỗ")
```

### Phân bố mật độ

```{r}
do_sff <- dat_sff %>% mutate(prop.do=(sum(subset(., Ho=="Đỗ")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đỗ")
do_plotf <- do_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.do, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=do_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(do_plotf$prop.do[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Đỗ")
```

## Doãn

### Phân bố tỉ lệ

```{r}
doan1_sf <- dat_sf %>% mutate(prop.doan1=(sum(subset(., Ho=="Doãn")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Doãn")
doan1_plot <- doan1_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.doan1, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=doan1_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(doan1_plot$prop.doan1[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Doãn")
```

### Phân bố mật độ

```{r}
doan1_sff <- dat_sff %>% mutate(prop.doan1=(sum(subset(., Ho=="Doãn")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Doãn")
doan1_plotf <- doan1_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.doan1, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=doan1_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(doan1_plotf$prop.doan1[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Doãn")
```

## Đoàn

### Phân bố tỉ lệ

```{r}
doan_sf <- dat_sf %>% mutate(prop.doan=(sum(subset(., Ho=="Đoàn")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đoàn")
doan_plot <- doan_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.doan, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=doan_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(doan_plot$prop.doan[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Đoàn")
```

### Phân bố mật độ

```{r}
doan_sff <- dat_sff %>% mutate(prop.doan=(sum(subset(., Ho=="Đoàn")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đoàn")
doan_plotf <- doan_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.doan, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=doan_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(doan_plotf$prop.doan[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Đoàn")
```

## Đới

### Phân bố tỉ lệ

```{r}
doi_sf <- dat_sf %>% mutate(prop.doi=(sum(subset(., Ho=="Đới")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đới")
doi_plot <- doi_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.doi, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=doi_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(doi_plot$prop.doi[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Đới")
```

### Phân bố mật độ

```{r}
doi_sff <- dat_sff %>% mutate(prop.doi=(sum(subset(., Ho=="Đới")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đới")
doi_plotf <- doi_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.doi, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=doi_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(doi_plotf$prop.doi[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Đới")
```

## Đồng

### Phân bố tỉ lệ

```{r}
dong_sf <- dat_sf %>% mutate(prop.dong=(sum(subset(., Ho=="Đồng")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đồng")
dong_plot <- dong_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.dong, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=dong_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(dong_plot$prop.dong[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Đồng")
```

### Phân bố mật độ

```{r}
dong_sff <- dat_sff %>% mutate(prop.dong=(sum(subset(., Ho=="Đồng")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đồng")
dong_plotf <- dong_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.dong, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=dong_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(dong_plotf$prop.dong[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Đồng")
```

## Dư

### Phân bố tỉ lệ

```{r}
du_sf <- dat_sf %>% mutate(prop.du=(sum(subset(., Ho=="Dư")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Dư")
du_plot <- du_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.du, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=du_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(du_plot$prop.du[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Dư")
```

### Phân bố mật độ

```{r}
du_sff <- dat_sff %>% mutate(prop.du=(sum(subset(., Ho=="Dư")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Dư")
du_plotf <- du_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.du, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=du_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(du_plotf$prop.du[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Dư")
```

## Dương

### Phân bố tỉ lệ

```{r}
duong_sf <- dat_sf %>% mutate(prop.duong=(sum(subset(., Ho=="Dương")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Dương")
duong_plot <- duong_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.duong, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=duong_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(duong_plot$prop.duong[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Dương")
```

### Phân bố mật độ

```{r}
duong_sff <- dat_sff %>% mutate(prop.duong=(sum(subset(., Ho=="Dương")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Dương")
duong_plotf <- duong_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.duong, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=duong_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(duong_plotf$prop.duong[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Dương")
```

## Đường

### Phân bố tỉ lệ

```{r}
duong2_sf <- dat_sf %>% mutate(prop.duong2=(sum(subset(., Ho=="Đường")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đường")
duong2_plot <- duong2_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.duong2, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=duong2_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(duong2_plot$prop.duong2[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Đường")
```

### Phân bố mật độ

```{r}
duong2_sff <- dat_sff %>% mutate(prop.duong2=(sum(subset(., Ho=="Đường")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Đường")
duong2_plotf <- duong2_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.duong2, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=duong2_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(duong2_plotf$prop.duong2[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Đường")
```

## Giang

### Phân bố tỉ lệ

```{r}
giang_sf <- dat_sf %>% mutate(prop.giang=(sum(subset(., Ho=="Giang")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Giang")
giang_plot <- giang_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.giang, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=giang_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(giang_plot$prop.giang[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Giang")
```

### Phân bố mật độ

```{r}
giang_sff <- dat_sff %>% mutate(prop.giang=(sum(subset(., Ho=="Giang")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Giang")
giang_plotf <- giang_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.giang, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=giang_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(giang_plotf$prop.giang[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Giang")
```

## Giàng

### Phân bố tỉ lệ

```{r}
giang2_sf <- dat_sf %>% mutate(prop.giang2=(sum(subset(., Ho=="Giàng")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Giàng")
giang2_plot <- giang2_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.giang2, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=giang2_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(giang2_plot$prop.giang2[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Giàng")
```

### Phân bố mật độ

```{r}
giang2_sff <- dat_sff %>% mutate(prop.giang2=(sum(subset(., Ho=="Giàng")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Giàng")
giang2_plotf <- giang2_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.giang2, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=giang2_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(giang2_plotf$prop.giang2[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Giàng")
```

## Giáp

### Phân bố tỉ lệ

```{r}
giap_sf <- dat_sf %>% mutate(prop.giap=(sum(subset(., Ho=="Giáp")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Giáp")
giap_plot <- giap_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.giap, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=giap_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(giap_plot$prop.giap[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Giáp")
```

### Phân bố mật độ

```{r}
giap_sff <- dat_sff %>% mutate(prop.giap=(sum(subset(., Ho=="Giáp")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Giáp")
giap_plotf <- giap_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.giap, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=giap_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(giap_plotf$prop.giap[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Giáp")
```

## H

### Phân bố tỉ lệ

```{r}
h_sf <- dat_sf %>% mutate(prop.h=(sum(subset(., Ho=="H")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="H")
h_plot <- h_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.h, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=h_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(h_plot$prop.h[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("H")
```

### Phân bố mật độ

```{r}
h_sff <- dat_sff %>% mutate(prop.h=(sum(subset(., Ho=="H")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="H")
h_plotf <- h_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.h, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=h_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(h_plotf$prop.h[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("H")
```

## H'

### Phân bố tỉ lệ

```{r}
h1_sf <- dat_sf %>% mutate(prop.h1=(sum(subset(., Ho=="H'")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="H'")
h1_plot <- h1_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.h1, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=h1_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(h1_plot$prop.h1[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("H'")
```

### Phân bố mật độ

```{r}
h1_sff <- dat_sff %>% mutate(prop.h1=(sum(subset(., Ho=="H'")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="H'")
h1_plotf <- h1_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.h1, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=h1_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(h1_plotf$prop.h1[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("H'")
```

## Ha

### Phân bố tỉ lệ

```{r}
ha1_sf <- dat_sf %>% mutate(prop.ha1=(sum(subset(., Ho=="Ha")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Ha")
ha1_plot <- ha1_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.ha1, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=ha1_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(ha1_plot$prop.ha1[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Ha")
```

### Phân bố mật độ

```{r}
ha1_sff <- dat_sff %>% mutate(prop.ha1=(sum(subset(., Ho=="Ha")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Ha")
ha1_plotf <- ha1_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.ha1, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=ha1_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(ha1_plotf$prop.ha1[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Ha")
```

## Hà

### Phân bố tỉ lệ

```{r}
ha_sf <- dat_sf %>% mutate(prop.ha=(sum(subset(., Ho=="Hà")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Hà")
ha_plot <- ha_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.ha, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=ha_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(ha_plot$prop.ha[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Hà")
```

### Phân bố mật độ

```{r}
ha_sff <- dat_sff %>% mutate(prop.ha=(sum(subset(., Ho=="Hà")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Hà")
ha_plotf <- ha_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.ha, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=ha_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(ha_plotf$prop.ha[1],1), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Hà")
```

## Hạ

### Phân bố tỉ lệ

```{r}
ha2_sf <- dat_sf %>% mutate(prop.ha2=(sum(subset(., Ho=="Hạ")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Hạ")
ha2_plot <- ha2_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.ha2, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=ha2_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(ha2_plot$prop.ha2[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Hạ")
```

### Phân bố mật độ

```{r}
ha2_sff <- dat_sff %>% mutate(prop.ha2=(sum(subset(., Ho=="Hạ")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Hạ")
ha2_plotf <- ha2_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.ha2, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=ha2_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(ha2_plotf$prop.ha2[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Hạ")
```

## Hán

### Phân bố tỉ lệ

```{r}
han1_sf <- dat_sf %>% mutate(prop.han1=(sum(subset(., Ho=="Hán")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Hán")
han1_plot <- han1_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.han1, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=han1_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(han1_plot$prop.han1[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Hán")
```

### Phân bố mật độ

```{r}
han1_sff <- dat_sff %>% mutate(prop.han1=(sum(subset(., Ho=="Hán")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Hán")
han1_plotf <- han1_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.han1, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=han1_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(han1_plotf$prop.han1[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Hán")
```

## Hàn

### Phân bố tỉ lệ

```{r}
han2_sf <- dat_sf %>% mutate(prop.han2=(sum(subset(., Ho=="Hàn")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Hàn")
han2_plot <- han2_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.han2, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=han2_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(han2_plot$prop.han2[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Hàn")
```

### Phân bố mật độ

```{r}
han2_sff <- dat_sff %>% mutate(prop.han2=(sum(subset(., Ho=="Hàn")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Hàn")
han2_plotf <- han2_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.han2, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=han2_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(han2_plotf$prop.han2[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Hàn")
```

## Hàng

### Phân bố tỉ lệ

```{r}
hang1_sf <- dat_sf %>% mutate(prop.hang1=(sum(subset(., Ho=="Hàng")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Hàng")
hang1_plot <- hang1_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.hang1, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=hang1_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(hang1_plot$prop.hang1[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Hàng")
```

### Phân bố mật độ

```{r}
hang1_sff <- dat_sff %>% mutate(prop.hang1=(sum(subset(., Ho=="Hàng")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Hàng")
hang1_plotf <- hang1_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.hang1, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=hang1_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(hang1_plotf$prop.hang1[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Hàng")
```

## Hảng

### Phân bố tỉ lệ

```{r}
hang2_sf <- dat_sf %>% mutate(prop.hang2=(sum(subset(., Ho=="Hảng")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Hảng")
hang2_plot <- hang2_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.hang2, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=hang2_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(hang2_plot$prop.hang2[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Hảng")
```

### Phân bố mật độ

```{r}
hang2_sff <- dat_sff %>% mutate(prop.hang2=(sum(subset(., Ho=="Hảng")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Hảng")
hang2_plotf <- hang2_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.hang2, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=hang2_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(hang2_plotf$prop.hang2[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Hảng")
```

## Hạng

### Phân bố tỉ lệ

```{r}
hang3_sf <- dat_sf %>% mutate(prop.hang3=(sum(subset(., Ho=="Hạng")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Hạng")
hang3_plot <- hang3_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.hang3, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=hang3_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(hang3_plot$prop.hang3[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Hạng")
```

### Phân bố mật độ

```{r}
hang3_sff <- dat_sff %>% mutate(prop.hang3=(sum(subset(., Ho=="Hạng")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Hạng")
hang3_plotf <- hang3_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.hang3, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=hang3_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(hang3_plotf$prop.hang3[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Hạng")
```

## Hầu

### Phân bố tỉ lệ

```{r}
hau_sf <- dat_sf %>% mutate(prop.hau=(sum(subset(., Ho=="Hầu")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Hầu")
hau_plot <- hau_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.hau, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=hau_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(hau_plot$prop.hau[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Hầu")
```

### Phân bố mật độ

```{r}
hau_sff <- dat_sff %>% mutate(prop.hau=(sum(subset(., Ho=="Hầu")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Hầu")
hau_plotf <- hau_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.hau, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=hau_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(hau_plotf$prop.hau[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Hầu")
```

## Ho

### Phân bố tỉ lệ

```{r}
ho1_sf <- dat_sf %>% mutate(prop.ho1=(sum(subset(., Ho=="Ho")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Ho")
ho1_plot <- ho1_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.ho1, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=ho1_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(ho1_plot$prop.ho1[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Ho")
```

### Phân bố mật độ

```{r}
ho1_sff <- dat_sff %>% mutate(prop.ho1=(sum(subset(., Ho=="Ho")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Ho")
ho1_plotf <- ho1_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.ho1, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=ho1_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(ho1_plotf$prop.ho1[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Ho")
```

## Hồ

### Phân bố tỉ lệ

```{r}
ho2_sf <- dat_sf %>% mutate(prop.ho2=(sum(subset(., Ho=="Hồ")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Hồ")
ho2_plot <- ho2_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.ho2, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=ho2_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(ho2_plot$prop.ho2[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Hồ")
```

### Phân bố mật độ

```{r}
ho2_sff <- dat_sff %>% mutate(prop.ho2=(sum(subset(., Ho=="Hồ")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Hồ")
ho2_plotf <- ho2_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.ho2, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=ho2_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(ho2_plotf$prop.ho2[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Hồ")
```

## Hờ

### Phân bố tỉ lệ

```{r}
ho3_sf <- dat_sf %>% mutate(prop.ho3=(sum(subset(., Ho=="Hờ")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Hờ")
ho3_plot <- ho3_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.ho3, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=ho3_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(ho3_plot$prop.ho3[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Hờ")
```

### Phân bố mật độ

```{r}
ho3_sff <- dat_sff %>% mutate(prop.ho3=(sum(subset(., Ho=="Hờ")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Hờ")
ho3_plotf <- ho3_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.ho3, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=ho3_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(ho3_plotf$prop.ho3[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Hờ")
```

## Hoàng

### Phân bố tỉ lệ

```{r}
hoang_sf <- dat_sf %>% mutate(prop.hoang=(sum(subset(., Ho=="Hoàng")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Hoàng")
hoang_plot <- hoang_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.hoang, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=hoang_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(hoang_plot$prop.hoang[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Hoàng")
```

### Phân bố mật độ

```{r}
hoang_sff <- dat_sff %>% mutate(prop.hoang=(sum(subset(., Ho=="Hoàng")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Hoàng")
hoang_plotf <- hoang_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.hoang, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=hoang_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(hoang_plotf$prop.hoang[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Hoàng")
```

## Hứa

### Phân bố tỉ lệ

```{r}
hua_sf <- dat_sf %>% mutate(prop.hua=(sum(subset(., Ho=="Hứa")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Hứa")
hua_plot <- hua_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.hua, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=hua_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(hua_plot$prop.hua[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Hứa")
```

### Phân bố mật độ

```{r}
hua_sff <- dat_sff %>% mutate(prop.hua=(sum(subset(., Ho=="Hứa")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Hứa")
hua_plotf <- hua_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.hua, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=hua_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(hua_plotf$prop.hua[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Hứa")
```

## Hùng

### Phân bố tỉ lệ

```{r}
hung_sf <- dat_sf %>% mutate(prop.hung=(sum(subset(., Ho=="Hùng")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Hùng")
hung_plot <- hung_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.hung, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=hung_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(hung_plot$prop.hung[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Hùng")
```

### Phân bố mật độ

```{r}
hung_sff <- dat_sff %>% mutate(prop.hung=(sum(subset(., Ho=="Hùng")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Hùng")
hung_plotf <- hung_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.hung, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=hung_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(hung_plotf$prop.hung[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Hùng")
```

## Huỳnh

### Phân bố tỉ lệ

```{r}
huynh_sf <- dat_sf %>% mutate(prop.huynh=(sum(subset(., Ho=="Huỳnh")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Huỳnh")
huynh_plot <- huynh_sf %>% select(NAME_1, NAME_2, NAME_3, pro.pop, prop.huynh, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=huynh_plot, aes(fill=pro.pop), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(huynh_plot$prop.huynh[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Tỉ lệ (%)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Huỳnh")
```

### Phân bố mật độ

```{r}
huynh_sff <- dat_sff %>% mutate(prop.huynh=(sum(subset(., Ho=="Huỳnh")[, "songuoi"])/sum(songuoi))*100) %>% filter(Ho=="Huỳnh")
huynh_plotf <- huynh_sff %>% select(NAME_1, NAME_2, NAME_3, songuoi_km, prop.huynh, geometry) %>% st_as_sf(crs = 4326)

ggplot() + geom_sf() + geom_sf(data=huynh_plotf, aes(fill=songuoi_km), color=NA) +
  geom_sf(data=river3, col="white") +
  annotate(geom="text", x=108, y=23, color="red", size=15, label= paste(round(huynh_plotf$prop.huynh[1],2), "% dân số", sep = "")) +
  scale_fill_viridis("Mật độ (người/km2)", direction = -1, option = "viridis") +
  theme_bw() +
  theme(text = element_text(size=45), axis.text.x = element_text(size=30), axis.text.y = element_text(size=30), legend.text=element_text(size=30), legend.key.size = unit(2, "cm"), plot.title = element_text(size = 45)) +
  ggtitle("Huỳnh")
```
















